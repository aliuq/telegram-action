"use strict";const filterQueryCache=new Map;function matchFilter(i){const e=Array.isArray(i)?i:[i],t=e.join(","),r=filterQueryCache.get(t)??(()=>{const n=parse(e),a=compile(n);return filterQueryCache.set(t,a),a})();return n=>r(n)}function parse(i){return Array.isArray(i)?i.map(e=>e.split(":")):[i.split(":")]}function compile(i){const e=i.flatMap(n=>check(n,preprocess(n))),t=treeify(e),r=arborist(t);return n=>!!r(n.update,n)}function preprocess(i){const e=UPDATE_KEYS,t=[i].flatMap(r=>{const[n,a,o]=r;if(!(n in L1_SHORTCUTS))return[r];if(!n&&!a&&!o)return[r];const u=L1_SHORTCUTS[n].map(l=>[l,a,o]);return a===void 0||a in L2_SHORTCUTS&&(a||o)?u:u.filter(([l])=>!!e[l]?.[a])}).flatMap(r=>{const[n,a,o]=r;if(!(a in L2_SHORTCUTS))return[r];if(!a&&!o)return[r];const u=L2_SHORTCUTS[a].map(l=>[n,l,o]);return o===void 0?u:u.filter(([,l])=>!!e[n]?.[l]?.[o])});if(t.length===0)throw new Error(`Shortcuts in '${i.join(":")}' do not expand to any valid filter query`);return t}function check(i,e){if(e.length===0)throw new Error("Empty filter query given");const t=e.map(checkOne).filter(r=>r!==!0);if(t.length===0)return e;throw t.length===1?new Error(t[0]):new Error(`Invalid filter query '${i.join(":")}'. There are ${t.length} errors after expanding the contained shortcuts: ${t.join("; ")}`)}function checkOne(i){const[e,t,r,...n]=i;if(e===void 0)return"Empty filter query given";if(!(e in UPDATE_KEYS)){const p=Object.keys(UPDATE_KEYS);return`Invalid L1 filter '${e}' given in '${i.join(":")}'. Permitted values are: ${p.map(u=>`'${u}'`).join(", ")}.`}if(t===void 0)return!0;const a=UPDATE_KEYS[e];if(!(t in a)){const p=Object.keys(a);return`Invalid L2 filter '${t}' given in '${i.join(":")}'. Permitted values are: ${p.map(u=>`'${u}'`).join(", ")}.`}if(r===void 0)return!0;const o=a[t];if(!(r in o)){const p=Object.keys(o);return`Invalid L3 filter '${r}' given in '${i.join(":")}'. ${p.length===0?`No further filtering is possible after '${e}:${t}'.`:`Permitted values are: ${p.map(u=>`'${u}'`).join(", ")}.`}`}return n.length===0?!0:`Cannot filter further than three levels, ':${n.join(":")}' is invalid!`}function treeify(i){const e={};for(const[t,r,n]of i){const a=e[t]??={};if(r!==void 0){const o=a[r]??=new Set;n!==void 0&&o.add(n)}}return e}function or(i,e){return(t,r)=>i(t,r)||e(t,r)}function concat(i,e){return(t,r)=>{const n=i(t,r);return n&&e(n,r)}}function leaf(i){return(e,t)=>i(e,t)!=null}function arborist(i){const e=Object.entries(i).map(([t,r])=>{const n=o=>o[t],a=Object.entries(r).map(([o,p])=>{const u=c=>c[o],l=Array.from(p).map(c=>c==="me"?(f,I)=>{const C=I.me.id;return testMaybeArray(f,b=>b.id===C)}:f=>testMaybeArray(f,I=>I[c]||I.type===c));return l.length===0?leaf(u):concat(u,l.reduce(or))});return a.length===0?leaf(n):concat(n,a.reduce(or))});if(e.length===0)throw new Error("Cannot create filter function for empty query");return e.reduce(or)}function testMaybeArray(i,e){const t=r=>r!=null&&e(r);return Array.isArray(i)?i.some(t):t(i)}const ENTITY_KEYS={mention:{},hashtag:{},cashtag:{},bot_command:{},url:{},email:{},phone_number:{},bold:{},italic:{},underline:{},strikethrough:{},spoiler:{},blockquote:{},expandable_blockquote:{},code:{},pre:{},text_link:{},text_mention:{},custom_emoji:{}},USER_KEYS={me:{},is_bot:{},is_premium:{},added_to_attachment_menu:{}},FORWARD_ORIGIN_KEYS={user:{},hidden_user:{},chat:{},channel:{}},STICKER_KEYS={is_video:{},is_animated:{},premium_animation:{}},REACTION_KEYS={emoji:{},custom_emoji:{},paid:{}},COMMON_MESSAGE_KEYS={forward_origin:FORWARD_ORIGIN_KEYS,is_topic_message:{},is_automatic_forward:{},business_connection_id:{},text:{},animation:{},audio:{},document:{},paid_media:{},photo:{},sticker:STICKER_KEYS,story:{},video:{},video_note:{},voice:{},contact:{},dice:{},game:{},poll:{},venue:{},location:{},entities:ENTITY_KEYS,caption_entities:ENTITY_KEYS,caption:{},effect_id:{},has_media_spoiler:{},new_chat_title:{},new_chat_photo:{},delete_chat_photo:{},message_auto_delete_timer_changed:{},pinned_message:{},invoice:{},proximity_alert_triggered:{},chat_background_set:{},giveaway_created:{},giveaway:{only_new_members:{},has_public_winners:{}},giveaway_winners:{only_new_members:{},was_refunded:{}},giveaway_completed:{},video_chat_scheduled:{},video_chat_started:{},video_chat_ended:{},video_chat_participants_invited:{},web_app_data:{}},MESSAGE_KEYS={...COMMON_MESSAGE_KEYS,new_chat_members:USER_KEYS,left_chat_member:USER_KEYS,group_chat_created:{},supergroup_chat_created:{},migrate_to_chat_id:{},migrate_from_chat_id:{},successful_payment:{},refunded_payment:{},users_shared:{},chat_shared:{},connected_website:{},write_access_allowed:{},passport_data:{},boost_added:{},forum_topic_created:{},forum_topic_edited:{name:{},icon_custom_emoji_id:{}},forum_topic_closed:{},forum_topic_reopened:{},general_forum_topic_hidden:{},general_forum_topic_unhidden:{},sender_boost_count:{}},CHANNEL_POST_KEYS={...COMMON_MESSAGE_KEYS,channel_chat_created:{}},BUSINESS_CONNECTION_KEYS={can_reply:{},is_enabled:{}},MESSAGE_REACTION_KEYS={old_reaction:REACTION_KEYS,new_reaction:REACTION_KEYS},MESSAGE_REACTION_COUNT_UPDATED_KEYS={reactions:REACTION_KEYS},CALLBACK_QUERY_KEYS={data:{},game_short_name:{}},CHAT_MEMBER_UPDATED_KEYS={from:USER_KEYS},UPDATE_KEYS={message:MESSAGE_KEYS,edited_message:MESSAGE_KEYS,channel_post:CHANNEL_POST_KEYS,edited_channel_post:CHANNEL_POST_KEYS,business_connection:BUSINESS_CONNECTION_KEYS,business_message:MESSAGE_KEYS,edited_business_message:MESSAGE_KEYS,deleted_business_messages:{},inline_query:{},chosen_inline_result:{},callback_query:CALLBACK_QUERY_KEYS,shipping_query:{},pre_checkout_query:{},poll:{},poll_answer:{},my_chat_member:CHAT_MEMBER_UPDATED_KEYS,chat_member:CHAT_MEMBER_UPDATED_KEYS,chat_join_request:{},message_reaction:MESSAGE_REACTION_KEYS,message_reaction_count:MESSAGE_REACTION_COUNT_UPDATED_KEYS,chat_boost:{},removed_chat_boost:{},purchased_paid_media:{}},L1_SHORTCUTS={"":["message","channel_post"],msg:["message","channel_post"],edit:["edited_message","edited_channel_post"]},L2_SHORTCUTS={"":["entities","caption_entities"],media:["photo","video"],file:["photo","animation","audio","document","video","video_note","voice","sticker"]},checker={filterQuery(i){const e=matchFilter(i);return t=>e(t)},text(i){const e=checker.filterQuery([":text",":caption"]),t=triggerFn(i);return r=>{if(!e(r))return!1;const n=r.message??r.channelPost,a=n.text??n.caption;return match(r,a,t)}},command(i){const e=checker.filterQuery(":entities:bot_command"),t=new Set,r=new Set;return toArray(i).forEach(n=>{if(n.startsWith("/"))throw new Error(`Do not include '/' when registering command handlers (use '${n.substring(1)}' not '${n}')`);(n.includes("@")?t:r).add(n)}),n=>{if(!e(n))return!1;const a=n.message??n.channelPost,o=a.text??a.caption;return a.entities.some(p=>{if(p.type!=="bot_command"||p.offset!==0)return!1;const u=o.substring(1,p.length);if(r.has(u)||t.has(u))return n.match=o.substring(u.length+1).trimStart(),!0;const l=u.indexOf("@");if(l===-1)return!1;const c=u.substring(l+1).toLowerCase(),g=n.me.username.toLowerCase();if(c!==g)return!1;const f=u.substring(0,l);return r.has(f)?(n.match=o.substring(u.length+1).trimStart(),!0):!1})}},reaction(i){const e=checker.filterQuery("message_reaction"),t=typeof i=="string"?[{type:"emoji",emoji:i}]:(Array.isArray(i)?i:[i]).map(o=>typeof o=="string"?{type:"emoji",emoji:o}:o),r=new Set(t.filter(o=>o.type==="emoji").map(o=>o.emoji)),n=new Set(t.filter(o=>o.type==="custom_emoji").map(o=>o.custom_emoji_id)),a=t.some(o=>o.type==="paid");return o=>{if(!e(o))return!1;const{old_reaction:p,new_reaction:u}=o.messageReaction;for(const l of u){let c=!1;if(l.type==="emoji"){for(const g of p)if(g.type==="emoji"&&g.emoji===l.emoji){c=!0;break}}else if(l.type==="custom_emoji"){for(const g of p)if(g.type==="custom_emoji"&&g.custom_emoji_id===l.custom_emoji_id){c=!0;break}}else if(l.type==="paid"){for(const g of p)if(g.type==="paid"){c=!0;break}}if(!c)if(l.type==="emoji"){if(r.has(l.emoji))return!0}else if(l.type==="custom_emoji"){if(n.has(l.custom_emoji_id))return!0}else if(l.type==="paid"){if(a)return!0}else return!0}return!1}},chatType(i){const e=new Set(toArray(i));return t=>t.chat?.type!==void 0&&e.has(t.chat.type)},callbackQuery(i){const e=checker.filterQuery("callback_query:data"),t=triggerFn(i);return r=>e(r)&&match(r,r.callbackQuery.data,t)},gameQuery(i){const e=checker.filterQuery("callback_query:game_short_name"),t=triggerFn(i);return r=>e(r)&&match(r,r.callbackQuery.game_short_name,t)},inlineQuery(i){const e=checker.filterQuery("inline_query"),t=triggerFn(i);return r=>e(r)&&match(r,r.inlineQuery.query,t)},chosenInlineResult(i){const e=checker.filterQuery("chosen_inline_result"),t=triggerFn(i);return r=>e(r)&&match(r,r.chosenInlineResult.result_id,t)},preCheckoutQuery(i){const e=checker.filterQuery("pre_checkout_query"),t=triggerFn(i);return r=>e(r)&&match(r,r.preCheckoutQuery.invoice_payload,t)},shippingQuery(i){const e=checker.filterQuery("shipping_query"),t=triggerFn(i);return r=>e(r)&&match(r,r.shippingQuery.invoice_payload,t)}};class Context{update;api;me;match;constructor(e,t,r){this.update=e,this.api=t,this.me=r}get message(){return this.update.message}get editedMessage(){return this.update.edited_message}get channelPost(){return this.update.channel_post}get editedChannelPost(){return this.update.edited_channel_post}get businessConnection(){return this.update.business_connection}get businessMessage(){return this.update.business_message}get editedBusinessMessage(){return this.update.edited_business_message}get deletedBusinessMessages(){return this.update.deleted_business_messages}get messageReaction(){return this.update.message_reaction}get messageReactionCount(){return this.update.message_reaction_count}get inlineQuery(){return this.update.inline_query}get chosenInlineResult(){return this.update.chosen_inline_result}get callbackQuery(){return this.update.callback_query}get shippingQuery(){return this.update.shipping_query}get preCheckoutQuery(){return this.update.pre_checkout_query}get poll(){return this.update.poll}get pollAnswer(){return this.update.poll_answer}get myChatMember(){return this.update.my_chat_member}get chatMember(){return this.update.chat_member}get chatJoinRequest(){return this.update.chat_join_request}get chatBoost(){return this.update.chat_boost}get removedChatBoost(){return this.update.removed_chat_boost}get purchasedPaidMedia(){return this.update.purchased_paid_media}get msg(){return this.message??this.editedMessage??this.channelPost??this.editedChannelPost??this.businessMessage??this.editedBusinessMessage??this.callbackQuery?.message}get chat(){return(this.msg??this.deletedBusinessMessages??this.messageReaction??this.messageReactionCount??this.myChatMember??this.chatMember??this.chatJoinRequest??this.chatBoost??this.removedChatBoost)?.chat}get senderChat(){return this.msg?.sender_chat}get from(){return(this.businessConnection??this.messageReaction??(this.chatBoost?.boost??this.removedChatBoost)?.source)?.user??(this.callbackQuery??this.msg??this.inlineQuery??this.chosenInlineResult??this.shippingQuery??this.preCheckoutQuery??this.myChatMember??this.chatMember??this.chatJoinRequest??this.purchasedPaidMedia)?.from}get msgId(){return this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id}get chatId(){return this.chat?.id??this.businessConnection?.user_chat_id}get inlineMessageId(){return this.callbackQuery?.inline_message_id??this.chosenInlineResult?.inline_message_id}get businessConnectionId(){return this.msg?.business_connection_id??this.businessConnection?.id??this.deletedBusinessMessages?.business_connection_id}entities(e){const t=this.msg;if(t===void 0)return[];const r=t.text??t.caption;if(r===void 0)return[];let n=t.entities??t.caption_entities;if(n===void 0)return[];if(e!==void 0){const a=new Set(toArray(e));n=n.filter(o=>a.has(o.type))}return n.map(a=>({...a,text:r.substring(a.offset,a.offset+a.length)}))}reactions(){const e=[],t=[],r=[],n=[],a=[],o=[],p=[],u=[];let l=!1,c=!1;const g=this.messageReaction;if(g!==void 0){const{old_reaction:f,new_reaction:I}=g;for(const C of I)C.type==="emoji"?e.push(C.emoji):C.type==="custom_emoji"?a.push(C.custom_emoji_id):C.type==="paid"&&(l=c=!0);for(const C of f)C.type==="emoji"?n.push(C.emoji):C.type==="custom_emoji"?u.push(C.custom_emoji_id):C.type==="paid"&&(c=!1);t.push(...e),o.push(...a);for(let C=0;C<n.length;C++){const b=t.length;if(b===0)break;const _=n[C];for(let M=0;M<b;M++)if(_===t[M]){r.push(_),n.splice(C,1),t.splice(M,1),C--;break}}for(let C=0;C<u.length;C++){const b=o.length;if(b===0)break;const _=u[C];for(let M=0;M<b;M++)if(_===o[M]){p.push(_),u.splice(C,1),o.splice(M,1),C--;break}}}return{emoji:e,emojiAdded:t,emojiKept:r,emojiRemoved:n,customEmoji:a,customEmojiAdded:o,customEmojiKept:p,customEmojiRemoved:u,paid:l,paidAdded:c}}static has=checker;has(e){return Context.has.filterQuery(e)(this)}hasText(e){return Context.has.text(e)(this)}hasCommand(e){return Context.has.command(e)(this)}hasReaction(e){return Context.has.reaction(e)(this)}hasChatType(e){return Context.has.chatType(e)(this)}hasCallbackQuery(e){return Context.has.callbackQuery(e)(this)}hasGameQuery(e){return Context.has.gameQuery(e)(this)}hasInlineQuery(e){return Context.has.inlineQuery(e)(this)}hasChosenInlineResult(e){return Context.has.chosenInlineResult(e)(this)}hasPreCheckoutQuery(e){return Context.has.preCheckoutQuery(e)(this)}hasShippingQuery(e){return Context.has.shippingQuery(e)(this)}reply(e,t,r){return this.api.sendMessage(orThrow(this.chatId,"sendMessage"),e,{business_connection_id:this.businessConnectionId,...t},r)}forwardMessage(e,t,r){return this.api.forwardMessage(e,orThrow(this.chatId,"forwardMessage"),orThrow(this.msgId,"forwardMessage"),t,r)}forwardMessages(e,t,r,n){return this.api.forwardMessages(e,orThrow(this.chatId,"forwardMessages"),t,r,n)}copyMessage(e,t,r){return this.api.copyMessage(e,orThrow(this.chatId,"copyMessage"),orThrow(this.msgId,"copyMessage"),t,r)}copyMessages(e,t,r,n){return this.api.copyMessages(e,orThrow(this.chatId,"copyMessages"),t,r,n)}replyWithPhoto(e,t,r){return this.api.sendPhoto(orThrow(this.chatId,"sendPhoto"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithAudio(e,t,r){return this.api.sendAudio(orThrow(this.chatId,"sendAudio"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithDocument(e,t,r){return this.api.sendDocument(orThrow(this.chatId,"sendDocument"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithVideo(e,t,r){return this.api.sendVideo(orThrow(this.chatId,"sendVideo"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithAnimation(e,t,r){return this.api.sendAnimation(orThrow(this.chatId,"sendAnimation"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithVoice(e,t,r){return this.api.sendVoice(orThrow(this.chatId,"sendVoice"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithVideoNote(e,t,r){return this.api.sendVideoNote(orThrow(this.chatId,"sendVideoNote"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithMediaGroup(e,t,r){return this.api.sendMediaGroup(orThrow(this.chatId,"sendMediaGroup"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithLocation(e,t,r,n){return this.api.sendLocation(orThrow(this.chatId,"sendLocation"),e,t,{business_connection_id:this.businessConnectionId,...r},n)}editMessageLiveLocation(e,t,r,n){const a=this.inlineMessageId;return a!==void 0?this.api.editMessageLiveLocationInline(a,e,t,r):this.api.editMessageLiveLocation(orThrow(this.chatId,"editMessageLiveLocation"),orThrow(this.msgId,"editMessageLiveLocation"),e,t,r,n)}stopMessageLiveLocation(e,t){const r=this.inlineMessageId;return r!==void 0?this.api.stopMessageLiveLocationInline(r,e):this.api.stopMessageLiveLocation(orThrow(this.chatId,"stopMessageLiveLocation"),orThrow(this.msgId,"stopMessageLiveLocation"),e,t)}sendPaidMedia(e,t,r,n){return this.api.sendPaidMedia(orThrow(this.chatId,"sendPaidMedia"),e,t,r,n)}replyWithVenue(e,t,r,n,a,o){return this.api.sendVenue(orThrow(this.chatId,"sendVenue"),e,t,r,n,{business_connection_id:this.businessConnectionId,...a},o)}replyWithContact(e,t,r,n){return this.api.sendContact(orThrow(this.chatId,"sendContact"),e,t,{business_connection_id:this.businessConnectionId,...r},n)}replyWithPoll(e,t,r,n){return this.api.sendPoll(orThrow(this.chatId,"sendPoll"),e,t,{business_connection_id:this.businessConnectionId,...r},n)}replyWithDice(e,t,r){return this.api.sendDice(orThrow(this.chatId,"sendDice"),e,{business_connection_id:this.businessConnectionId,...t},r)}replyWithChatAction(e,t,r){return this.api.sendChatAction(orThrow(this.chatId,"sendChatAction"),e,{business_connection_id:this.businessConnectionId,...t},r)}react(e,t,r){return this.api.setMessageReaction(orThrow(this.chatId,"setMessageReaction"),orThrow(this.msgId,"setMessageReaction"),typeof e=="string"?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map(n=>typeof n=="string"?{type:"emoji",emoji:n}:n),t,r)}getUserProfilePhotos(e,t){return this.api.getUserProfilePhotos(orThrow(this.from,"getUserProfilePhotos").id,e,t)}setUserEmojiStatus(e,t){return this.api.setUserEmojiStatus(orThrow(this.from,"setUserEmojiStatus").id,e,t)}getUserChatBoosts(e,t){return this.api.getUserChatBoosts(e,orThrow(this.from,"getUserChatBoosts").id,t)}getBusinessConnection(e){return this.api.getBusinessConnection(orThrow(this.businessConnectionId,"getBusinessConnection"),e)}getFile(e){const t=orThrow(this.msg,"getFile"),r=t.photo!==void 0?t.photo[t.photo.length-1]:t.animation??t.audio??t.document??t.video??t.video_note??t.voice??t.sticker;return this.api.getFile(orThrow(r,"getFile").file_id,e)}kickAuthor(...e){return this.banAuthor(...e)}banAuthor(e,t){return this.api.banChatMember(orThrow(this.chatId,"banAuthor"),orThrow(this.from,"banAuthor").id,e,t)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,t,r){return this.api.banChatMember(orThrow(this.chatId,"banChatMember"),e,t,r)}unbanChatMember(e,t,r){return this.api.unbanChatMember(orThrow(this.chatId,"unbanChatMember"),e,t,r)}restrictAuthor(e,t,r){return this.api.restrictChatMember(orThrow(this.chatId,"restrictAuthor"),orThrow(this.from,"restrictAuthor").id,e,t,r)}restrictChatMember(e,t,r,n){return this.api.restrictChatMember(orThrow(this.chatId,"restrictChatMember"),e,t,r,n)}promoteAuthor(e,t){return this.api.promoteChatMember(orThrow(this.chatId,"promoteAuthor"),orThrow(this.from,"promoteAuthor").id,e,t)}promoteChatMember(e,t,r){return this.api.promoteChatMember(orThrow(this.chatId,"promoteChatMember"),e,t,r)}setChatAdministratorAuthorCustomTitle(e,t){return this.api.setChatAdministratorCustomTitle(orThrow(this.chatId,"setChatAdministratorAuthorCustomTitle"),orThrow(this.from,"setChatAdministratorAuthorCustomTitle").id,e,t)}setChatAdministratorCustomTitle(e,t,r){return this.api.setChatAdministratorCustomTitle(orThrow(this.chatId,"setChatAdministratorCustomTitle"),e,t,r)}banChatSenderChat(e,t){return this.api.banChatSenderChat(orThrow(this.chatId,"banChatSenderChat"),e,t)}unbanChatSenderChat(e,t){return this.api.unbanChatSenderChat(orThrow(this.chatId,"unbanChatSenderChat"),e,t)}setChatPermissions(e,t,r){return this.api.setChatPermissions(orThrow(this.chatId,"setChatPermissions"),e,t,r)}exportChatInviteLink(e){return this.api.exportChatInviteLink(orThrow(this.chatId,"exportChatInviteLink"),e)}createChatInviteLink(e,t){return this.api.createChatInviteLink(orThrow(this.chatId,"createChatInviteLink"),e,t)}editChatInviteLink(e,t,r){return this.api.editChatInviteLink(orThrow(this.chatId,"editChatInviteLink"),e,t,r)}createChatSubscriptionInviteLink(e,t,r,n){return this.api.createChatSubscriptionInviteLink(orThrow(this.chatId,"createChatSubscriptionInviteLink"),e,t,r,n)}editChatSubscriptionInviteLink(e,t,r){return this.api.editChatSubscriptionInviteLink(orThrow(this.chatId,"editChatSubscriptionInviteLink"),e,t,r)}revokeChatInviteLink(e,t){return this.api.revokeChatInviteLink(orThrow(this.chatId,"editChatInviteLink"),e,t)}approveChatJoinRequest(e,t){return this.api.approveChatJoinRequest(orThrow(this.chatId,"approveChatJoinRequest"),e,t)}declineChatJoinRequest(e,t){return this.api.declineChatJoinRequest(orThrow(this.chatId,"declineChatJoinRequest"),e,t)}setChatPhoto(e,t){return this.api.setChatPhoto(orThrow(this.chatId,"setChatPhoto"),e,t)}deleteChatPhoto(e){return this.api.deleteChatPhoto(orThrow(this.chatId,"deleteChatPhoto"),e)}setChatTitle(e,t){return this.api.setChatTitle(orThrow(this.chatId,"setChatTitle"),e,t)}setChatDescription(e,t){return this.api.setChatDescription(orThrow(this.chatId,"setChatDescription"),e,t)}pinChatMessage(e,t,r){return this.api.pinChatMessage(orThrow(this.chatId,"pinChatMessage"),e,t,r)}unpinChatMessage(e,t){return this.api.unpinChatMessage(orThrow(this.chatId,"unpinChatMessage"),e,t)}unpinAllChatMessages(e){return this.api.unpinAllChatMessages(orThrow(this.chatId,"unpinAllChatMessages"),e)}leaveChat(e){return this.api.leaveChat(orThrow(this.chatId,"leaveChat"),e)}getChat(e){return this.api.getChat(orThrow(this.chatId,"getChat"),e)}getChatAdministrators(e){return this.api.getChatAdministrators(orThrow(this.chatId,"getChatAdministrators"),e)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e){return this.api.getChatMemberCount(orThrow(this.chatId,"getChatMemberCount"),e)}getAuthor(e){return this.api.getChatMember(orThrow(this.chatId,"getAuthor"),orThrow(this.from,"getAuthor").id,e)}getChatMember(e,t){return this.api.getChatMember(orThrow(this.chatId,"getChatMember"),e,t)}setChatStickerSet(e,t){return this.api.setChatStickerSet(orThrow(this.chatId,"setChatStickerSet"),e,t)}deleteChatStickerSet(e){return this.api.deleteChatStickerSet(orThrow(this.chatId,"deleteChatStickerSet"),e)}createForumTopic(e,t,r){return this.api.createForumTopic(orThrow(this.chatId,"createForumTopic"),e,t,r)}editForumTopic(e,t){const r=orThrow(this.msg,"editForumTopic"),n=orThrow(r.message_thread_id,"editForumTopic");return this.api.editForumTopic(r.chat.id,n,e,t)}closeForumTopic(e){const t=orThrow(this.msg,"closeForumTopic"),r=orThrow(t.message_thread_id,"closeForumTopic");return this.api.closeForumTopic(t.chat.id,r,e)}reopenForumTopic(e){const t=orThrow(this.msg,"reopenForumTopic"),r=orThrow(t.message_thread_id,"reopenForumTopic");return this.api.reopenForumTopic(t.chat.id,r,e)}deleteForumTopic(e){const t=orThrow(this.msg,"deleteForumTopic"),r=orThrow(t.message_thread_id,"deleteForumTopic");return this.api.deleteForumTopic(t.chat.id,r,e)}unpinAllForumTopicMessages(e){const t=orThrow(this.msg,"unpinAllForumTopicMessages"),r=orThrow(t.message_thread_id,"unpinAllForumTopicMessages");return this.api.unpinAllForumTopicMessages(t.chat.id,r,e)}editGeneralForumTopic(e,t){return this.api.editGeneralForumTopic(orThrow(this.chatId,"editGeneralForumTopic"),e,t)}closeGeneralForumTopic(e){return this.api.closeGeneralForumTopic(orThrow(this.chatId,"closeGeneralForumTopic"),e)}reopenGeneralForumTopic(e){return this.api.reopenGeneralForumTopic(orThrow(this.chatId,"reopenGeneralForumTopic"),e)}hideGeneralForumTopic(e){return this.api.hideGeneralForumTopic(orThrow(this.chatId,"hideGeneralForumTopic"),e)}unhideGeneralForumTopic(e){return this.api.unhideGeneralForumTopic(orThrow(this.chatId,"unhideGeneralForumTopic"),e)}unpinAllGeneralForumTopicMessages(e){return this.api.unpinAllGeneralForumTopicMessages(orThrow(this.chatId,"unpinAllGeneralForumTopicMessages"),e)}answerCallbackQuery(e,t){return this.api.answerCallbackQuery(orThrow(this.callbackQuery,"answerCallbackQuery").id,typeof e=="string"?{text:e}:e,t)}setChatMenuButton(e,t){return this.api.setChatMenuButton(e,t)}getChatMenuButton(e,t){return this.api.getChatMenuButton(e,t)}setMyDefaultAdministratorRights(e,t){return this.api.setMyDefaultAdministratorRights(e,t)}getMyDefaultAdministratorRights(e,t){return this.api.getMyDefaultAdministratorRights(e,t)}editMessageText(e,t,r){const n=this.inlineMessageId;return n!==void 0?this.api.editMessageTextInline(n,e,t):this.api.editMessageText(orThrow(this.chatId,"editMessageText"),orThrow(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageText"),e,t,r)}editMessageCaption(e,t){const r=this.inlineMessageId;return r!==void 0?this.api.editMessageCaptionInline(r,e):this.api.editMessageCaption(orThrow(this.chatId,"editMessageCaption"),orThrow(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageCaption"),e,t)}editMessageMedia(e,t,r){const n=this.inlineMessageId;return n!==void 0?this.api.editMessageMediaInline(n,e,t):this.api.editMessageMedia(orThrow(this.chatId,"editMessageMedia"),orThrow(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageMedia"),e,t,r)}editMessageReplyMarkup(e,t){const r=this.inlineMessageId;return r!==void 0?this.api.editMessageReplyMarkupInline(r,e):this.api.editMessageReplyMarkup(orThrow(this.chatId,"editMessageReplyMarkup"),orThrow(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageReplyMarkup"),e,t)}stopPoll(e,t){return this.api.stopPoll(orThrow(this.chatId,"stopPoll"),orThrow(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"stopPoll"),e,t)}deleteMessage(e){return this.api.deleteMessage(orThrow(this.chatId,"deleteMessage"),orThrow(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"deleteMessage"),e)}deleteMessages(e,t){return this.api.deleteMessages(orThrow(this.chatId,"deleteMessages"),e,t)}replyWithSticker(e,t,r){return this.api.sendSticker(orThrow(this.chatId,"sendSticker"),e,{business_connection_id:this.businessConnectionId,...t},r)}getCustomEmojiStickers(e){return this.api.getCustomEmojiStickers((this.msg?.entities??[]).filter(t=>t.type==="custom_emoji").map(t=>t.custom_emoji_id),e)}replyWithGift(e,t,r){return this.api.sendGift(orThrow(this.from,"sendGift").id,e,t,r)}answerInlineQuery(e,t,r){return this.api.answerInlineQuery(orThrow(this.inlineQuery,"answerInlineQuery").id,e,t,r)}savePreparedInlineMessage(e,t,r){return this.api.savePreparedInlineMessage(orThrow(this.from,"savePreparedInlineMessage").id,e,t,r)}replyWithInvoice(e,t,r,n,a,o,p){return this.api.sendInvoice(orThrow(this.chatId,"sendInvoice"),e,t,r,n,a,o,p)}answerShippingQuery(e,t,r){return this.api.answerShippingQuery(orThrow(this.shippingQuery,"answerShippingQuery").id,e,t,r)}answerPreCheckoutQuery(e,t,r){return this.api.answerPreCheckoutQuery(orThrow(this.preCheckoutQuery,"answerPreCheckoutQuery").id,e,typeof t=="string"?{error_message:t}:t,r)}refundStarPayment(e){return this.api.refundStarPayment(orThrow(this.from,"refundStarPayment").id,orThrow(this.msg?.successful_payment,"refundStarPayment").telegram_payment_charge_id,e)}editUserStarSubscription(e,t,r){return this.api.editUserStarSubscription(orThrow(this.from,"editUserStarSubscription").id,e,t,r)}setPassportDataErrors(e,t){return this.api.setPassportDataErrors(orThrow(this.from,"setPassportDataErrors").id,e,t)}replyWithGame(e,t,r){return this.api.sendGame(orThrow(this.chatId,"sendGame"),e,{business_connection_id:this.businessConnectionId,...t},r)}}function orThrow(i,e){if(i===void 0)throw new Error(`Missing information for API call to ${e}`);return i}function triggerFn(i){return toArray(i).map(e=>typeof e=="string"?t=>t===e?e:null:t=>t.match(e))}function match(i,e,t){for(const r of t){const n=r(e);if(n)return i.match=n,!0}return!1}function toArray(i){return Array.isArray(i)?i:[i]}class BotError extends Error{error;ctx;constructor(e,t){super(generateBotErrorMessage(e)),this.error=e,this.ctx=t,this.name="BotError",e instanceof Error&&(this.stack=e.stack)}}function generateBotErrorMessage(i){let e;if(i instanceof Error)e=`${i.name} in middleware: ${i.message}`;else{const t=typeof i;switch(e=`Non-error value of type ${t} thrown in middleware`,t){case"bigint":case"boolean":case"number":case"symbol":e+=`: ${i}`;break;case"string":e+=`: ${String(i).substring(0,50)}`;break;default:e+="!";break}}return e}function flatten(i){return typeof i=="function"?i:(e,t)=>i.middleware()(e,t)}function concat1(i,e){return async(t,r)=>{let n=!1;await i(t,async()=>{if(n)throw new Error("`next` already called before!");n=!0,await e(t,r)})}}function pass(i,e){return e()}const leaf1=()=>Promise.resolve();async function run(i,e){await i(e,leaf1)}class Composer{handler;constructor(...e){this.handler=e.length===0?pass:e.map(flatten).reduce(concat1)}middleware(){return this.handler}use(...e){const t=new Composer(...e);return this.handler=concat1(this.handler,flatten(t)),t}on(e,...t){return this.filter(Context.has.filterQuery(e),...t)}hears(e,...t){return this.filter(Context.has.text(e),...t)}command(e,...t){return this.filter(Context.has.command(e),...t)}reaction(e,...t){return this.filter(Context.has.reaction(e),...t)}chatType(e,...t){return this.filter(Context.has.chatType(e),...t)}callbackQuery(e,...t){return this.filter(Context.has.callbackQuery(e),...t)}gameQuery(e,...t){return this.filter(Context.has.gameQuery(e),...t)}inlineQuery(e,...t){return this.filter(Context.has.inlineQuery(e),...t)}chosenInlineResult(e,...t){return this.filter(Context.has.chosenInlineResult(e),...t)}preCheckoutQuery(e,...t){return this.filter(Context.has.preCheckoutQuery(e),...t)}shippingQuery(e,...t){return this.filter(Context.has.shippingQuery(e),...t)}filter(e,...t){const r=new Composer(...t);return this.branch(e,r,pass),r}drop(e,...t){return this.filter(async r=>!await e(r),...t)}fork(...e){const t=new Composer(...e),r=flatten(t);return this.use((n,a)=>Promise.all([a(),run(r,n)])),t}lazy(e){return this.use(async(t,r)=>{const n=await e(t),a=Array.isArray(n)?n:[n];await flatten(new Composer(...a))(t,r)})}route(e,t,r=pass){return this.lazy(async n=>{const a=await e(n);return(a===void 0||!t[a]?r:t[a])??[]})}branch(e,t,r){return this.lazy(async n=>await e(n)?t:r)}errorBoundary(e,...t){const r=new Composer(...t),n=flatten(r);return this.use(async(a,o)=>{let p=!1;const u=()=>(p=!0,Promise.resolve());try{await n(a,u)}catch(l){p=!1,await e(new BotError(l,a),u)}p&&await o()}),r}}var s=1e3,m=s*60,h=m*60,d=h*24,w=d*7,y=d*365.25,ms=function(i,e){e=e||{};var t=typeof i;if(t==="string"&&i.length>0)return parse1(i);if(t==="number"&&isFinite(i))return e.long?fmtLong(i):fmtShort(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))};function parse1(i){if(i=String(i),!(i.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*y;case"weeks":case"week":case"w":return t*w;case"days":case"day":case"d":return t*d;case"hours":case"hour":case"hrs":case"hr":case"h":return t*h;case"minutes":case"minute":case"mins":case"min":case"m":return t*m;case"seconds":case"second":case"secs":case"sec":case"s":return t*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function fmtShort(i){var e=Math.abs(i);return e>=d?Math.round(i/d)+"d":e>=h?Math.round(i/h)+"h":e>=m?Math.round(i/m)+"m":e>=s?Math.round(i/s)+"s":i+"ms"}function fmtLong(i){var e=Math.abs(i);return e>=d?plural(i,e,d,"day"):e>=h?plural(i,e,h,"hour"):e>=m?plural(i,e,m,"minute"):e>=s?plural(i,e,s,"second"):i+" ms"}function plural(i,e,t,r){var n=e>=t*1.5;return Math.round(i/t)+" "+r+(n?"s":"")}function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout,globalContext;typeof window<"u"?globalContext=window:typeof self<"u"?globalContext=self:globalContext={},typeof globalContext.setTimeout=="function"&&(cachedSetTimeout=setTimeout),typeof globalContext.clearTimeout=="function"&&(cachedClearTimeout=clearTimeout);function runTimeout(i){if(cachedSetTimeout===setTimeout)return setTimeout(i,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(i,0);try{return cachedSetTimeout(i,0)}catch{try{return cachedSetTimeout.call(null,i,0)}catch{return cachedSetTimeout.call(this,i,0)}}}function runClearTimeout(i){if(cachedClearTimeout===clearTimeout)return clearTimeout(i);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(i);try{return cachedClearTimeout(i)}catch{try{return cachedClearTimeout.call(null,i)}catch{return cachedClearTimeout.call(this,i)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var i=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(i)}}function nextTick(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];queue.push(new Item(i,e)),queue.length===1&&!draining&&runTimeout(drainQueue)}function Item(i,e){this.fun=i,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(i){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(i){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=globalContext.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return new Date().getTime()};function hrtime(i){var e=performanceNow.call(performance)*.001,t=Math.floor(e),r=Math.floor(e%1*1e9);return i&&(t=t-i[0],r=r-i[1],r<0&&(t--,r+=1e9)),[t,r]}var startTime=new Date;function uptime(){var i=new Date,e=i-startTime;return e/1e3}var process={nextTick,title,browser,env:{NODE_ENV:"production"},argv,version,versions,on,addListener,once,off,removeListener,removeAllListeners,emit,binding,cwd,chdir,umask,hrtime,platform,release,config,uptime};function createCommonjsModule(i,e,t){return t={path:e,exports:{},require:function(r,n){return commonjsRequire(r,n??t.path)}},i(t,t.exports),t.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function setup(i){t.debug=t,t.default=t,t.coerce=u,t.disable=a,t.enable=n,t.enabled=o,t.humanize=ms,t.destroy=l,Object.keys(i).forEach(c=>{t[c]=i[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let g=0;for(let f=0;f<c.length;f++)g=(g<<5)-g+c.charCodeAt(f),g|=0;return t.colors[Math.abs(g)%t.colors.length]}t.selectColor=e;function t(c){let g,f=null,I,C;function b(..._){if(!b.enabled)return;const M=b,k=Number(new Date),F=k-(g||k);M.diff=F,M.prev=g,M.curr=k,g=k,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let v=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(T,S)=>{if(T==="%%")return"%";v++;const A=t.formatters[S];if(typeof A=="function"){const P=_[v];T=A.call(M,P),_.splice(v,1),v--}return T}),t.formatArgs.call(M,_),(M.log||t.log).apply(M,_)}return b.namespace=c,b.useColors=t.useColors(),b.color=t.selectColor(c),b.extend=r,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(I!==t.namespaces&&(I=t.namespaces,C=t.enabled(c)),C),set:_=>{f=_}}),typeof t.init=="function"&&t.init(b),b}function r(c,g){const f=t(this.namespace+(typeof g>"u"?":":g)+c);return f.log=this.log,f}function n(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let g;const f=(typeof c=="string"?c:"").split(/[\s,]+/),I=f.length;for(g=0;g<I;g++)f[g]&&(c=f[g].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.slice(1)+"$")):t.names.push(new RegExp("^"+c+"$")))}function a(){const c=[...t.names.map(p),...t.skips.map(p).map(g=>"-"+g)].join(",");return t.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let g,f;for(g=0,f=t.skips.length;g<f;g++)if(t.skips[g].test(c))return!1;for(g=0,f=t.names.length;g<f;g++)if(t.names[g].test(c))return!0;return!1}function p(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function u(c){return c instanceof Error?c.stack||c.message:c}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var common=setup,browser$1=createCommonjsModule(function(i,e){e.formatArgs=r,e.save=n,e.load=a,e.useColors=t,e.storage=o(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let c=0,g=0;u[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(c++,f==="%c"&&(g=c))}),u.splice(g,0,l)}e.log=console.debug||console.log||(()=>{});function n(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function a(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=process.env.DEBUG),u}function o(){try{return localStorage}catch{}}i.exports=common(e);const{formatters:p}=i.exports;p.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}});browser$1.colors,browser$1.destroy,browser$1.formatArgs,browser$1.load,browser$1.log,browser$1.save,browser$1.storage,browser$1.useColors;const itrToStream=i=>{const e=i[Symbol.asyncIterator]();return new ReadableStream({async pull(t){const r=await e.next();r.done?t.close():t.enqueue(r.value)}})},baseFetchConfig=i=>({}),debug=browser$1("grammy:warn");class GrammyError extends Error{method;payload;ok;error_code;description;parameters;constructor(e,t,r,n){super(`${e} (${t.error_code}: ${t.description})`),this.method=r,this.payload=n,this.ok=!1,this.name="GrammyError",this.error_code=t.error_code,this.description=t.description,this.parameters=t.parameters??{}}}function toGrammyError(i,e,t){switch(i.error_code){case 401:debug("Error 401 means that your bot token is wrong, talk to https://t.me/BotFather to check it.");break;case 409:debug("Error 409 means that you are running your bot several times on long polling. Consider revoking the bot token if you believe that no other instance is running.");break}return new GrammyError(`Call to '${e}' failed!`,i,e,t)}class HttpError extends Error{error;constructor(e,t){super(e),this.error=t,this.name="HttpError"}}function isTelegramError(i){return typeof i=="object"&&i!==null&&"status"in i&&"statusText"in i}function toHttpError(i,e){return t=>{let r=`Network request for '${i}' failed!`;throw isTelegramError(t)&&(r+=` (${t.status}: ${t.statusText})`),e&&t instanceof Error&&(r+=` ${t.message}`),new HttpError(r,t)}}const osType=(()=>{const{Deno:i}=globalThis;if(typeof i?.build?.os=="string")return i.build.os;const{navigator:e}=globalThis;return e?.appVersion?.includes?.("Win")?"windows":"linux"})(),isWindows=osType==="windows";function assertPath(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function stripSuffix(i,e){if(e.length>=i.length)return i;const t=i.length-e.length;for(let r=e.length-1;r>=0;--r)if(i.charCodeAt(t+r)!==e.charCodeAt(r))return i;return i.slice(0,-e.length)}function lastPathSegment(i,e,t=0){let r=!1,n=i.length;for(let a=i.length-1;a>=t;--a)if(e(i.charCodeAt(a))){if(r){t=a+1;break}}else r||(r=!0,n=a+1);return i.slice(t,n)}function assertArgs(i,e){if(assertPath(i),i.length===0)return i;if(typeof e!="string")throw new TypeError(`Suffix must be a string. Received ${JSON.stringify(e)}`)}function stripTrailingSeparators(i,e){if(i.length<=1)return i;let t=i.length;for(let r=i.length-1;r>0&&e(i.charCodeAt(r));r--)t=r;return i.slice(0,t)}function isPosixPathSeparator(i){return i===47}function basename(i,e=""){assertArgs(i,e);const t=lastPathSegment(i,isPosixPathSeparator),r=stripTrailingSeparators(t,isPosixPathSeparator);return e?stripSuffix(r,e):r}function isPathSeparator(i){return i===47||i===92}function isWindowsDeviceRoot(i){return i>=97&&i<=122||i>=65&&i<=90}function basename1(i,e=""){assertArgs(i,e);let t=0;if(i.length>=2){const a=i.charCodeAt(0);isWindowsDeviceRoot(a)&&i.charCodeAt(1)===58&&(t=2)}const r=lastPathSegment(i,isPathSeparator,t),n=stripTrailingSeparators(r,isPathSeparator);return e?stripSuffix(n,e):n}function basename2(i,e=""){return isWindows?basename1(i,e):basename(i,e)}class InputFile{consumed=!1;fileData;filename;constructor(e,t){this.fileData=e,t??=this.guessFilename(e),this.filename=t}guessFilename(e){if(typeof e=="string")return basename2(e);if(typeof e=="object"){if("url"in e)return basename2(e.url);if(e instanceof URL)return basename2(e.pathname)||basename2(e.hostname)}}toRaw(){if(this.consumed)throw new Error("Cannot reuse InputFile data source!");const e=this.fileData;return e instanceof Blob?e.stream():e instanceof URL?fetchFile(e):"url"in e?fetchFile(e.url):(e instanceof Uint8Array||(this.consumed=!0),e)}}async function*fetchFile(i){const{body:e}=await fetch(i);if(e===null)throw new Error(`Download failed, no response body from '${i}'`);yield*e}function requiresFormDataUpload(i){return i instanceof InputFile||typeof i=="object"&&i!==null&&Object.values(i).some(e=>Array.isArray(e)?e.some(requiresFormDataUpload):e instanceof InputFile||requiresFormDataUpload(e))}function str(i){return JSON.stringify(i,(e,t)=>t??void 0)}function createJsonPayload(i){return{method:"POST",headers:{"content-type":"application/json",connection:"keep-alive"},body:str(i)}}async function*protectItr(i,e){try{yield*i}catch(t){e(t)}}function createFormDataPayload(i,e){const t=createBoundary(),r=payloadToMultipartItr(i,t),n=protectItr(r,e),a=itrToStream(n);return{method:"POST",headers:{"content-type":`multipart/form-data; boundary=${t}`,connection:"keep-alive"},body:a}}function createBoundary(){return"----------"+randomId(32)}function randomId(i=16){return Array.from(Array(i)).map(()=>Math.random().toString(36)[2]||0).join("")}const enc=new TextEncoder;async function*payloadToMultipartItr(i,e){const t=extractFiles(i);yield enc.encode(`--${e}\r
`);const r=enc.encode(`\r
--${e}\r
`);let n=!0;for(const[a,o]of Object.entries(i))o!=null&&(n||(yield r),yield valuePart(a,typeof o=="object"?str(o):o),n=!1);for(const{id:a,origin:o,file:p}of t)n||(yield r),yield*filePart(a,o,p),n=!1;yield enc.encode(`\r
--${e}--\r
`)}function extractFiles(i){return typeof i!="object"||i===null?[]:Object.entries(i).flatMap(([e,t])=>{if(Array.isArray(t))return t.flatMap(r=>extractFiles(r));if(t instanceof InputFile){const r=randomId();Object.assign(i,{[e]:`attach://${r}`});const n=e==="media"&&"type"in i&&typeof i.type=="string"?i.type:e;return{id:r,origin:n,file:t}}else return extractFiles(t)})}function valuePart(i,e){return enc.encode(`content-disposition:form-data;name="${i}"\r
\r
${e}`)}async function*filePart(i,e,t){const r=t.filename||`${e}.${getExt(e)}`;if(r.includes("\r")||r.includes(`
`))throw new Error(`File paths cannot contain carriage-return (\\r) or newline (\\n) characters! Filename for property '${e}' was:
"""
${r}
"""`);yield enc.encode(`content-disposition:form-data;name="${i}";filename=${r}\r
content-type:application/octet-stream\r
\r
`);const n=await t.toRaw();n instanceof Uint8Array?yield n:yield*n}function getExt(i){switch(i){case"certificate":return"pem";case"photo":case"thumbnail":return"jpg";case"voice":return"ogg";case"audio":return"mp3";case"animation":case"video":case"video_note":return"mp4";case"sticker":return"webp";default:return"dat"}}const debug1=browser$1("grammy:core");function concatTransformer(i,e){return(t,r,n)=>e(i,t,r,n)}class ApiClient{token;webhookReplyEnvelope;options;fetch;hasUsedWebhookReply;installedTransformers;constructor(e,t={},r={}){this.token=e,this.webhookReplyEnvelope=r,this.hasUsedWebhookReply=!1,this.installedTransformers=[],this.call=async(u,l,c)=>{const g=l??{};debug1(`Calling ${u}`),c!==void 0&&validateSignal(u,g,c);const f=this.options,I=requiresFormDataUpload(g);if(this.webhookReplyEnvelope.send!==void 0&&!this.hasUsedWebhookReply&&!I&&f.canUseWebhookReply(u)){this.hasUsedWebhookReply=!0;const S=createJsonPayload({...g,method:u});return await this.webhookReplyEnvelope.send(S.body),{ok:!0,result:!0}}const C=createAbortControllerFromSignal(c),b=createTimeout(C,f.timeoutSeconds,u),_=createStreamError(C),M=f.buildUrl(f.apiRoot,this.token,u,f.environment),k=I?createFormDataPayload(g,S=>_.catch(S)):createJsonPayload(g),F=C.signal,v={...f.baseFetchConfig,signal:F,...k},T=[this.fetch(M instanceof URL?M.href:M,v).catch(toHttpError(u,f.sensitiveLogs)),_.promise,b.promise];try{return await(await Promise.race(T)).json()}finally{b.handle!==void 0&&clearTimeout(b.handle)}};const n=t.apiRoot??"https://api.telegram.org",a=t.environment??"prod",{fetch:o}=t,p=o??fetch;if(this.options={apiRoot:n,environment:a,buildUrl:t.buildUrl??defaultBuildUrl,timeoutSeconds:t.timeoutSeconds??500,baseFetchConfig:{...baseFetchConfig(),...t.baseFetchConfig},canUseWebhookReply:t.canUseWebhookReply??(()=>!1),sensitiveLogs:t.sensitiveLogs??!1,fetch:(...u)=>p(...u)},this.fetch=this.options.fetch,this.options.apiRoot.endsWith("/"))throw new Error(`Remove the trailing '/' from the 'apiRoot' option (use '${this.options.apiRoot.substring(0,this.options.apiRoot.length-1)}' instead of '${this.options.apiRoot}')`)}call;use(...e){return this.call=e.reduce(concatTransformer,this.call),this.installedTransformers.push(...e),this}async callApi(e,t,r){const n=await this.call(e,t,r);if(n.ok)return n.result;throw toGrammyError(n,e,t)}}function createRawApi(i,e,t){const r=new ApiClient(i,e,t),n={get(u,l){return l==="toJSON"?"__internal":l==="getMe"||l==="getWebhookInfo"||l==="getForumTopicIconStickers"||l==="logOut"||l==="close"?r.callApi.bind(r,l,{}):r.callApi.bind(r,l)},...proxyMethods},a=new Proxy({},n),o=r.installedTransformers,p={raw:a,installedTransformers:o,use:(...u)=>(r.use(...u),p)};return p}const defaultBuildUrl=(i,e,t,r)=>`${i}/bot${e}/${r==="test"?"test/":""}${t}`,proxyMethods={set(){return!1},defineProperty(){return!1},deleteProperty(){return!1},ownKeys(){return[]}};function createTimeout(i,e,t){let r;return{promise:new Promise((a,o)=>{r=setTimeout(()=>{const p=`Request to '${t}' timed out after ${e} seconds`;o(new Error(p)),i.abort()},1e3*e)}),handle:r}}function createStreamError(i){let e=r=>{throw r};return{promise:new Promise((r,n)=>{e=a=>{n(a),i.abort()}}),catch:e}}function createAbortControllerFromSignal(i){const e=new AbortController;if(i===void 0)return e;const t=i;function r(){e.abort(),t.removeEventListener("abort",r)}return t.aborted?r():t.addEventListener("abort",r),{abort:r,signal:e.signal}}function validateSignal(i,e,t){if(typeof t?.addEventListener=="function")return;let r=JSON.stringify(e);r.length>20&&(r=r.substring(0,16)+" ...");let n=JSON.stringify(t);throw n.length>20&&(n=n.substring(0,16)+" ..."),new Error(`Incorrect abort signal instance found! You passed two payloads to '${i}' but you should merge the second one containing '${n}' into the first one containing '${r}'! If you are using context shortcuts, you may want to use a method on 'ctx.api' instead.

If you want to prevent such mistakes in the future, consider using TypeScript. https://www.typescriptlang.org/`)}class Api{token;options;raw;config;constructor(e,t,r){this.token=e,this.options=t;const{raw:n,use:a,installedTransformers:o}=createRawApi(e,t,r);this.raw=n,this.config={use:a,installedTransformers:()=>o.slice()}}getUpdates(e,t){return this.raw.getUpdates({...e},t)}setWebhook(e,t,r){return this.raw.setWebhook({url:e,...t},r)}deleteWebhook(e,t){return this.raw.deleteWebhook({...e},t)}getWebhookInfo(e){return this.raw.getWebhookInfo(e)}getMe(e){return this.raw.getMe(e)}logOut(e){return this.raw.logOut(e)}close(e){return this.raw.close(e)}sendMessage(e,t,r,n){return this.raw.sendMessage({chat_id:e,text:t,...r},n)}forwardMessage(e,t,r,n,a){return this.raw.forwardMessage({chat_id:e,from_chat_id:t,message_id:r,...n},a)}forwardMessages(e,t,r,n,a){return this.raw.forwardMessages({chat_id:e,from_chat_id:t,message_ids:r,...n},a)}copyMessage(e,t,r,n,a){return this.raw.copyMessage({chat_id:e,from_chat_id:t,message_id:r,...n},a)}copyMessages(e,t,r,n,a){return this.raw.copyMessages({chat_id:e,from_chat_id:t,message_ids:r,...n},a)}sendPhoto(e,t,r,n){return this.raw.sendPhoto({chat_id:e,photo:t,...r},n)}sendAudio(e,t,r,n){return this.raw.sendAudio({chat_id:e,audio:t,...r},n)}sendDocument(e,t,r,n){return this.raw.sendDocument({chat_id:e,document:t,...r},n)}sendVideo(e,t,r,n){return this.raw.sendVideo({chat_id:e,video:t,...r},n)}sendAnimation(e,t,r,n){return this.raw.sendAnimation({chat_id:e,animation:t,...r},n)}sendVoice(e,t,r,n){return this.raw.sendVoice({chat_id:e,voice:t,...r},n)}sendVideoNote(e,t,r,n){return this.raw.sendVideoNote({chat_id:e,video_note:t,...r},n)}sendMediaGroup(e,t,r,n){return this.raw.sendMediaGroup({chat_id:e,media:t,...r},n)}sendLocation(e,t,r,n,a){return this.raw.sendLocation({chat_id:e,latitude:t,longitude:r,...n},a)}editMessageLiveLocation(e,t,r,n,a,o){return this.raw.editMessageLiveLocation({chat_id:e,message_id:t,latitude:r,longitude:n,...a},o)}editMessageLiveLocationInline(e,t,r,n,a){return this.raw.editMessageLiveLocation({inline_message_id:e,latitude:t,longitude:r,...n},a)}stopMessageLiveLocation(e,t,r,n){return this.raw.stopMessageLiveLocation({chat_id:e,message_id:t,...r},n)}stopMessageLiveLocationInline(e,t,r){return this.raw.stopMessageLiveLocation({inline_message_id:e,...t},r)}sendPaidMedia(e,t,r,n,a){return this.raw.sendPaidMedia({chat_id:e,star_count:t,media:r,...n},a)}sendVenue(e,t,r,n,a,o,p){return this.raw.sendVenue({chat_id:e,latitude:t,longitude:r,title:n,address:a,...o},p)}sendContact(e,t,r,n,a){return this.raw.sendContact({chat_id:e,phone_number:t,first_name:r,...n},a)}sendPoll(e,t,r,n,a){return this.raw.sendPoll({chat_id:e,question:t,options:r,...n},a)}sendDice(e,t,r,n){return this.raw.sendDice({chat_id:e,emoji:t,...r},n)}setMessageReaction(e,t,r,n,a){return this.raw.setMessageReaction({chat_id:e,message_id:t,reaction:r,...n},a)}sendChatAction(e,t,r,n){return this.raw.sendChatAction({chat_id:e,action:t,...r},n)}getUserProfilePhotos(e,t,r){return this.raw.getUserProfilePhotos({user_id:e,...t},r)}setUserEmojiStatus(e,t,r){return this.raw.setUserEmojiStatus({user_id:e,...t},r)}getUserChatBoosts(e,t,r){return this.raw.getUserChatBoosts({chat_id:e,user_id:t},r)}getBusinessConnection(e,t){return this.raw.getBusinessConnection({business_connection_id:e},t)}getFile(e,t){return this.raw.getFile({file_id:e},t)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,t,r,n){return this.raw.banChatMember({chat_id:e,user_id:t,...r},n)}unbanChatMember(e,t,r,n){return this.raw.unbanChatMember({chat_id:e,user_id:t,...r},n)}restrictChatMember(e,t,r,n,a){return this.raw.restrictChatMember({chat_id:e,user_id:t,permissions:r,...n},a)}promoteChatMember(e,t,r,n){return this.raw.promoteChatMember({chat_id:e,user_id:t,...r},n)}setChatAdministratorCustomTitle(e,t,r,n){return this.raw.setChatAdministratorCustomTitle({chat_id:e,user_id:t,custom_title:r},n)}banChatSenderChat(e,t,r){return this.raw.banChatSenderChat({chat_id:e,sender_chat_id:t},r)}unbanChatSenderChat(e,t,r){return this.raw.unbanChatSenderChat({chat_id:e,sender_chat_id:t},r)}setChatPermissions(e,t,r,n){return this.raw.setChatPermissions({chat_id:e,permissions:t,...r},n)}exportChatInviteLink(e,t){return this.raw.exportChatInviteLink({chat_id:e},t)}createChatInviteLink(e,t,r){return this.raw.createChatInviteLink({chat_id:e,...t},r)}editChatInviteLink(e,t,r,n){return this.raw.editChatInviteLink({chat_id:e,invite_link:t,...r},n)}createChatSubscriptionInviteLink(e,t,r,n,a){return this.raw.createChatSubscriptionInviteLink({chat_id:e,subscription_period:t,subscription_price:r,...n},a)}editChatSubscriptionInviteLink(e,t,r,n){return this.raw.editChatSubscriptionInviteLink({chat_id:e,invite_link:t,...r},n)}revokeChatInviteLink(e,t,r){return this.raw.revokeChatInviteLink({chat_id:e,invite_link:t},r)}approveChatJoinRequest(e,t,r){return this.raw.approveChatJoinRequest({chat_id:e,user_id:t},r)}declineChatJoinRequest(e,t,r){return this.raw.declineChatJoinRequest({chat_id:e,user_id:t},r)}setChatPhoto(e,t,r){return this.raw.setChatPhoto({chat_id:e,photo:t},r)}deleteChatPhoto(e,t){return this.raw.deleteChatPhoto({chat_id:e},t)}setChatTitle(e,t,r){return this.raw.setChatTitle({chat_id:e,title:t},r)}setChatDescription(e,t,r){return this.raw.setChatDescription({chat_id:e,description:t},r)}pinChatMessage(e,t,r,n){return this.raw.pinChatMessage({chat_id:e,message_id:t,...r},n)}unpinChatMessage(e,t,r){return this.raw.unpinChatMessage({chat_id:e,message_id:t},r)}unpinAllChatMessages(e,t){return this.raw.unpinAllChatMessages({chat_id:e},t)}leaveChat(e,t){return this.raw.leaveChat({chat_id:e},t)}getChat(e,t){return this.raw.getChat({chat_id:e},t)}getChatAdministrators(e,t){return this.raw.getChatAdministrators({chat_id:e},t)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e,t){return this.raw.getChatMemberCount({chat_id:e},t)}getChatMember(e,t,r){return this.raw.getChatMember({chat_id:e,user_id:t},r)}setChatStickerSet(e,t,r){return this.raw.setChatStickerSet({chat_id:e,sticker_set_name:t},r)}deleteChatStickerSet(e,t){return this.raw.deleteChatStickerSet({chat_id:e},t)}getForumTopicIconStickers(e){return this.raw.getForumTopicIconStickers(e)}createForumTopic(e,t,r,n){return this.raw.createForumTopic({chat_id:e,name:t,...r},n)}editForumTopic(e,t,r,n){return this.raw.editForumTopic({chat_id:e,message_thread_id:t,...r},n)}closeForumTopic(e,t,r){return this.raw.closeForumTopic({chat_id:e,message_thread_id:t},r)}reopenForumTopic(e,t,r){return this.raw.reopenForumTopic({chat_id:e,message_thread_id:t},r)}deleteForumTopic(e,t,r){return this.raw.deleteForumTopic({chat_id:e,message_thread_id:t},r)}unpinAllForumTopicMessages(e,t,r){return this.raw.unpinAllForumTopicMessages({chat_id:e,message_thread_id:t},r)}editGeneralForumTopic(e,t,r){return this.raw.editGeneralForumTopic({chat_id:e,name:t},r)}closeGeneralForumTopic(e,t){return this.raw.closeGeneralForumTopic({chat_id:e},t)}reopenGeneralForumTopic(e,t){return this.raw.reopenGeneralForumTopic({chat_id:e},t)}hideGeneralForumTopic(e,t){return this.raw.hideGeneralForumTopic({chat_id:e},t)}unhideGeneralForumTopic(e,t){return this.raw.unhideGeneralForumTopic({chat_id:e},t)}unpinAllGeneralForumTopicMessages(e,t){return this.raw.unpinAllGeneralForumTopicMessages({chat_id:e},t)}answerCallbackQuery(e,t,r){return this.raw.answerCallbackQuery({callback_query_id:e,...t},r)}setMyName(e,t,r){return this.raw.setMyName({name:e,...t},r)}getMyName(e,t){return this.raw.getMyName(e??{},t)}setMyCommands(e,t,r){return this.raw.setMyCommands({commands:e,...t},r)}deleteMyCommands(e,t){return this.raw.deleteMyCommands({...e},t)}getMyCommands(e,t){return this.raw.getMyCommands({...e},t)}setMyDescription(e,t,r){return this.raw.setMyDescription({description:e,...t},r)}getMyDescription(e,t){return this.raw.getMyDescription({...e},t)}setMyShortDescription(e,t,r){return this.raw.setMyShortDescription({short_description:e,...t},r)}getMyShortDescription(e,t){return this.raw.getMyShortDescription({...e},t)}setChatMenuButton(e,t){return this.raw.setChatMenuButton({...e},t)}getChatMenuButton(e,t){return this.raw.getChatMenuButton({...e},t)}setMyDefaultAdministratorRights(e,t){return this.raw.setMyDefaultAdministratorRights({...e},t)}getMyDefaultAdministratorRights(e,t){return this.raw.getMyDefaultAdministratorRights({...e},t)}editMessageText(e,t,r,n,a){return this.raw.editMessageText({chat_id:e,message_id:t,text:r,...n},a)}editMessageTextInline(e,t,r,n){return this.raw.editMessageText({inline_message_id:e,text:t,...r},n)}editMessageCaption(e,t,r,n){return this.raw.editMessageCaption({chat_id:e,message_id:t,...r},n)}editMessageCaptionInline(e,t,r){return this.raw.editMessageCaption({inline_message_id:e,...t},r)}editMessageMedia(e,t,r,n,a){return this.raw.editMessageMedia({chat_id:e,message_id:t,media:r,...n},a)}editMessageMediaInline(e,t,r,n){return this.raw.editMessageMedia({inline_message_id:e,media:t,...r},n)}editMessageReplyMarkup(e,t,r,n){return this.raw.editMessageReplyMarkup({chat_id:e,message_id:t,...r},n)}editMessageReplyMarkupInline(e,t,r){return this.raw.editMessageReplyMarkup({inline_message_id:e,...t},r)}stopPoll(e,t,r,n){return this.raw.stopPoll({chat_id:e,message_id:t,...r},n)}deleteMessage(e,t,r){return this.raw.deleteMessage({chat_id:e,message_id:t},r)}deleteMessages(e,t,r){return this.raw.deleteMessages({chat_id:e,message_ids:t},r)}sendSticker(e,t,r,n){return this.raw.sendSticker({chat_id:e,sticker:t,...r},n)}getStickerSet(e,t){return this.raw.getStickerSet({name:e},t)}getCustomEmojiStickers(e,t){return this.raw.getCustomEmojiStickers({custom_emoji_ids:e},t)}uploadStickerFile(e,t,r,n){return this.raw.uploadStickerFile({user_id:e,sticker_format:t,sticker:r},n)}createNewStickerSet(e,t,r,n,a,o){return this.raw.createNewStickerSet({user_id:e,name:t,title:r,stickers:n,...a},o)}addStickerToSet(e,t,r,n){return this.raw.addStickerToSet({user_id:e,name:t,sticker:r},n)}setStickerPositionInSet(e,t,r){return this.raw.setStickerPositionInSet({sticker:e,position:t},r)}deleteStickerFromSet(e,t){return this.raw.deleteStickerFromSet({sticker:e},t)}replaceStickerInSet(e,t,r,n,a){return this.raw.replaceStickerInSet({user_id:e,name:t,old_sticker:r,sticker:n},a)}setStickerEmojiList(e,t,r){return this.raw.setStickerEmojiList({sticker:e,emoji_list:t},r)}setStickerKeywords(e,t,r){return this.raw.setStickerKeywords({sticker:e,keywords:t},r)}setStickerMaskPosition(e,t,r){return this.raw.setStickerMaskPosition({sticker:e,mask_position:t},r)}setStickerSetTitle(e,t,r){return this.raw.setStickerSetTitle({name:e,title:t},r)}deleteStickerSet(e,t){return this.raw.deleteStickerSet({name:e},t)}setStickerSetThumbnail(e,t,r,n,a){return this.raw.setStickerSetThumbnail({name:e,user_id:t,thumbnail:r,format:n},a)}setCustomEmojiStickerSetThumbnail(e,t,r){return this.raw.setCustomEmojiStickerSetThumbnail({name:e,custom_emoji_id:t},r)}getAvailableGifts(e){return this.raw.getAvailableGifts(e)}sendGift(e,t,r,n){return this.raw.sendGift({user_id:e,gift_id:t,...r},n)}answerInlineQuery(e,t,r,n){return this.raw.answerInlineQuery({inline_query_id:e,results:t,...r},n)}answerWebAppQuery(e,t,r){return this.raw.answerWebAppQuery({web_app_query_id:e,result:t},r)}savePreparedInlineMessage(e,t,r,n){return this.raw.savePreparedInlineMessage({user_id:e,result:t,...r},n)}sendInvoice(e,t,r,n,a,o,p,u){return this.raw.sendInvoice({chat_id:e,title:t,description:r,payload:n,currency:a,prices:o,...p},u)}createInvoiceLink(e,t,r,n,a,o,p,u){return this.raw.createInvoiceLink({title:e,description:t,payload:r,provider_token:n,currency:a,prices:o,...p},u)}answerShippingQuery(e,t,r,n){return this.raw.answerShippingQuery({shipping_query_id:e,ok:t,...r},n)}answerPreCheckoutQuery(e,t,r,n){return this.raw.answerPreCheckoutQuery({pre_checkout_query_id:e,ok:t,...r},n)}getStarTransactions(e,t){return this.raw.getStarTransactions({...e},t)}refundStarPayment(e,t,r){return this.raw.refundStarPayment({user_id:e,telegram_payment_charge_id:t},r)}editUserStarSubscription(e,t,r,n){return this.raw.editUserStarSubscription({user_id:e,telegram_payment_charge_id:t,is_canceled:r},n)}setPassportDataErrors(e,t,r){return this.raw.setPassportDataErrors({user_id:e,errors:t},r)}sendGame(e,t,r,n){return this.raw.sendGame({chat_id:e,game_short_name:t,...r},n)}setGameScore(e,t,r,n,a,o){return this.raw.setGameScore({chat_id:e,message_id:t,user_id:r,score:n,...a},o)}setGameScoreInline(e,t,r,n,a){return this.raw.setGameScore({inline_message_id:e,user_id:t,score:r,...n},a)}getGameHighScores(e,t,r,n){return this.raw.getGameHighScores({chat_id:e,message_id:t,user_id:r},n)}getGameHighScoresInline(e,t,r){return this.raw.getGameHighScores({inline_message_id:e,user_id:t},r)}}const debug2=browser$1("grammy:bot"),debugWarn=browser$1("grammy:warn"),debugErr=browser$1("grammy:error"),DEFAULT_UPDATE_TYPES=["message","edited_message","channel_post","edited_channel_post","business_connection","business_message","edited_business_message","deleted_business_messages","inline_query","chosen_inline_result","callback_query","shipping_query","pre_checkout_query","poll","poll_answer","my_chat_member","chat_join_request","chat_boost","removed_chat_boost"];class Bot extends Composer{token;pollingRunning;pollingAbortController;lastTriedUpdateId;api;me;mePromise;clientConfig;ContextConstructor;observedUpdateTypes;errorHandler;constructor(e,t){if(super(),this.token=e,this.pollingRunning=!1,this.lastTriedUpdateId=0,this.observedUpdateTypes=new Set,this.errorHandler=async r=>{throw console.error("Error in middleware while handling update",r.ctx?.update?.update_id,r.error),console.error("No error handler was set!"),console.error("Set your own error handler with `bot.catch = ...`"),this.pollingRunning&&(console.error("Stopping bot"),await this.stop()),r},!e)throw new Error("Empty token!");this.me=t?.botInfo,this.clientConfig=t?.client,this.ContextConstructor=t?.ContextConstructor??Context,this.api=new Api(e,this.clientConfig)}set botInfo(e){this.me=e}get botInfo(){if(this.me===void 0)throw new Error("Bot information unavailable! Make sure to call `await bot.init()` before accessing `bot.botInfo`!");return this.me}on(e,...t){for(const[r]of parse(e).flatMap(preprocess))this.observedUpdateTypes.add(r);return super.on(e,...t)}reaction(e,...t){return this.observedUpdateTypes.add("message_reaction"),super.reaction(e,...t)}isInited(){return this.me!==void 0}async init(e){if(!this.isInited()){debug2("Initializing bot"),this.mePromise??=withRetries(()=>this.api.getMe(e),e);let t;try{t=await this.mePromise}finally{this.mePromise=void 0}this.me===void 0?this.me=t:debug2("Bot info was set by now, will not overwrite")}debug2(`I am ${this.me.username}!`)}async handleUpdates(e){for(const t of e){this.lastTriedUpdateId=t.update_id;try{await this.handleUpdate(t)}catch(r){if(r instanceof BotError)await this.errorHandler(r);else throw console.error("FATAL: grammY unable to handle:",r),r}}}async handleUpdate(e,t){if(this.me===void 0)throw new Error("Bot not initialized! Either call `await bot.init()`, or directly set the `botInfo` option in the `Bot` constructor to specify a known bot info object.");debug2(`Processing update ${e.update_id}`);const r=new Api(this.token,this.clientConfig,t),n=this.api.config.installedTransformers();n.length>0&&r.config.use(...n);const a=new this.ContextConstructor(e,r,this.me);try{await run(this.middleware(),a)}catch(o){throw debugErr(`Error in middleware for update ${e.update_id}`),new BotError(o,a)}}async start(e){const t=[];if(this.isInited()||t.push(this.init(this.pollingAbortController?.signal)),this.pollingRunning){await Promise.all(t),debug2("Simple long polling already running!");return}this.pollingRunning=!0,this.pollingAbortController=new AbortController;try{t.push(withRetries(async()=>{await this.api.deleteWebhook({drop_pending_updates:e?.drop_pending_updates},this.pollingAbortController?.signal)},this.pollingAbortController?.signal)),await Promise.all(t),await e?.onStart?.(this.botInfo)}catch(r){throw this.pollingRunning=!1,this.pollingAbortController=void 0,r}this.pollingRunning&&(validateAllowedUpdates(this.observedUpdateTypes,e?.allowed_updates),this.use=noUseFunction,debug2("Starting simple long polling"),await this.loop(e),debug2("Middleware is done running"))}async stop(){if(this.pollingRunning){debug2("Stopping bot, saving update offset"),this.pollingRunning=!1,this.pollingAbortController?.abort();const e=this.lastTriedUpdateId+1;await this.api.getUpdates({offset:e,limit:1}).finally(()=>this.pollingAbortController=void 0)}else debug2("Bot is not running!")}isRunning(){return this.pollingRunning}catch(e){this.errorHandler=e}async loop(e){const t=e?.limit,r=e?.timeout??30;let n=e?.allowed_updates??[];try{for(;this.pollingRunning;){const a=await this.fetchUpdates({limit:t,timeout:r,allowed_updates:n});if(a===void 0)break;await this.handleUpdates(a),n=void 0}}finally{this.pollingRunning=!1}}async fetchUpdates({limit:e,timeout:t,allowed_updates:r}){const n=this.lastTriedUpdateId+1;let a;do try{a=await this.api.getUpdates({offset:n,limit:e,timeout:t,allowed_updates:r},this.pollingAbortController?.signal)}catch(o){await this.handlePollingError(o)}while(a===void 0&&this.pollingRunning);return a}async handlePollingError(e){if(!this.pollingRunning){debug2("Pending getUpdates request cancelled");return}let t=3;if(e instanceof GrammyError){if(debugErr(e.message),e.error_code===401||e.error_code===409)throw e;e.error_code===429&&(debugErr("Bot API server is closing."),t=e.parameters.retry_after??t)}else debugErr(e);debugErr(`Call to getUpdates failed, retrying in ${t} seconds ...`),await sleep(t)}}async function withRetries(i,e){let r=50;async function n(o){let p=!1,u="rethrow";if(o instanceof HttpError)p=!0,u="retry";else if(o instanceof GrammyError){if(o.error_code>=500)p=!0,u="retry";else if(o.error_code===429){const l=o.parameters.retry_after;typeof l=="number"?(await sleep(l,e),r=50):p=!0,u="retry"}}if(p){r!==50&&await sleep(r,e);const l=20*60*1e3;r=Math.min(l,2*r)}return u}let a={ok:!1};for(;!a.ok;)try{a={ok:!0,value:await i()}}catch(o){switch(debugErr(o),await n(o)){case"retry":continue;case"rethrow":throw o}}return a.value}async function sleep(i,e){let t,r;function n(){r?.(new Error("Aborted delay")),t!==void 0&&clearTimeout(t)}try{await new Promise((a,o)=>{if(r=o,e?.aborted){n();return}e?.addEventListener("abort",n),t=setTimeout(a,1e3*i)})}finally{e?.removeEventListener("abort",n)}}function validateAllowedUpdates(i,e=DEFAULT_UPDATE_TYPES){const t=Array.from(i).filter(r=>!e.includes(r));t.length>0&&debugWarn(`You registered listeners for the following update types, but you did not specify them in \`allowed_updates\` so they may not be received: ${t.map(r=>`'${r}'`).join(", ")}`)}function noUseFunction(){throw new Error(`It looks like you are registering more listeners on your bot from within other listeners! This means that every time your bot handles a message like this one, new listeners will be added. This list grows until your machine crashes, so grammY throws this error to tell you that you should probably do things a bit differently. If you're unsure how to resolve this problem, you can ask in the group chat: https://telegram.me/grammyjs

On the other hand, if you actually know what you're doing and you do need to install further middleware while your bot is running, consider installing a composer instance on your bot, and in turn augment the composer after the fact. This way, you can circumvent this protection against memory leaks.`)}[...DEFAULT_UPDATE_TYPES],browser$1("grammy:session"),browser$1("grammy:error"),exports.Bot=Bot;
