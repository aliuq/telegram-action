"use strict";const require$$0$1=require("node:stream"),require$$1=require("node:util"),require$$0=require("node:events");function _interopDefaultCompat(_){return _&&typeof _=="object"&&"default"in _?_.default:_}const require$$0__default$1=_interopDefaultCompat(require$$0$1),require$$1__default=_interopDefaultCompat(require$$1),require$$0__default=_interopDefaultCompat(require$$0);var main={exports:{}},sbmh,hasRequiredSbmh;function requireSbmh(){if(hasRequiredSbmh)return sbmh;hasRequiredSbmh=1;const _=require$$0__default.EventEmitter,c=require$$1__default.inherits;function x(n){if(typeof n=="string"&&(n=Buffer.from(n)),!Buffer.isBuffer(n))throw new TypeError("The needle has to be a String or a Buffer.");const h=n.length;if(h===0)throw new Error("The needle cannot be an empty String/Buffer.");if(h>256)throw new Error("The needle cannot have a length bigger than 256.");this.maxMatches=1/0,this.matches=0,this._occ=new Array(256).fill(h),this._lookbehind_size=0,this._needle=n,this._bufpos=0,this._lookbehind=Buffer.alloc(h);for(var e=0;e<h-1;++e)this._occ[n[e]]=h-1-e}return c(x,_),x.prototype.reset=function(){this._lookbehind_size=0,this.matches=0,this._bufpos=0},x.prototype.push=function(n,h){Buffer.isBuffer(n)||(n=Buffer.from(n,"binary"));const e=n.length;this._bufpos=h||0;let s;for(;s!==e&&this.matches<this.maxMatches;)s=this._sbmh_feed(n);return s},x.prototype._sbmh_feed=function(n){const h=n.length,e=this._needle,s=e.length,u=e[s-1];let t=-this._lookbehind_size,r;if(t<0){for(;t<0&&t<=h-s;){if(r=this._sbmh_lookup_char(n,t+s-1),r===u&&this._sbmh_memcmp(n,t,s-1))return this._lookbehind_size=0,++this.matches,this.emit("info",!0),this._bufpos=t+s;t+=this._occ[r]}if(t<0)for(;t<0&&!this._sbmh_memcmp(n,t,h-t);)++t;if(t>=0)this.emit("info",!1,this._lookbehind,0,this._lookbehind_size),this._lookbehind_size=0;else{const i=this._lookbehind_size+t;return i>0&&this.emit("info",!1,this._lookbehind,0,i),this._lookbehind.copy(this._lookbehind,0,i,this._lookbehind_size-i),this._lookbehind_size-=i,n.copy(this._lookbehind,this._lookbehind_size),this._lookbehind_size+=h,this._bufpos=h,h}}if(t+=(t>=0)*this._bufpos,n.indexOf(e,t)!==-1)return t=n.indexOf(e,t),++this.matches,t>0?this.emit("info",!0,n,this._bufpos,t):this.emit("info",!0),this._bufpos=t+s;for(t=h-s;t<h&&(n[t]!==e[0]||Buffer.compare(n.subarray(t,t+h-t),e.subarray(0,h-t))!==0);)++t;return t<h&&(n.copy(this._lookbehind,0,t,t+(h-t)),this._lookbehind_size=h-t),t>0&&this.emit("info",!1,n,this._bufpos,t<h?t:h),this._bufpos=h,h},x.prototype._sbmh_lookup_char=function(n,h){return h<0?this._lookbehind[this._lookbehind_size+h]:n[h]},x.prototype._sbmh_memcmp=function(n,h,e){for(var s=0;s<e;++s)if(this._sbmh_lookup_char(n,h+s)!==this._needle[s])return!1;return!0},sbmh=x,sbmh}var PartStream_1,hasRequiredPartStream;function requirePartStream(){if(hasRequiredPartStream)return PartStream_1;hasRequiredPartStream=1;const _=require$$1__default.inherits,c=require$$0__default$1.Readable;function x(n){c.call(this,n)}return _(x,c),x.prototype._read=function(n){},PartStream_1=x,PartStream_1}var getLimit,hasRequiredGetLimit;function requireGetLimit(){return hasRequiredGetLimit||(hasRequiredGetLimit=1,getLimit=function(c,x,n){if(!c||c[x]===void 0||c[x]===null)return n;if(typeof c[x]!="number"||isNaN(c[x]))throw new TypeError("Limit "+x+" is not a valid number");return c[x]}),getLimit}var HeaderParser_1,hasRequiredHeaderParser;function requireHeaderParser(){if(hasRequiredHeaderParser)return HeaderParser_1;hasRequiredHeaderParser=1;const _=require$$0__default.EventEmitter,c=require$$1__default.inherits,x=requireGetLimit(),n=requireSbmh(),h=Buffer.from(`\r
\r
`),e=/\r\n/g,s=/^([^:]+):[ \t]?([\x00-\xFF]+)?$/;function u(t){_.call(this),t=t||{};const r=this;this.nread=0,this.maxed=!1,this.npairs=0,this.maxHeaderPairs=x(t,"maxHeaderPairs",2e3),this.maxHeaderSize=x(t,"maxHeaderSize",80*1024),this.buffer="",this.header={},this.finished=!1,this.ss=new n(h),this.ss.on("info",function(i,f,a,l){f&&!r.maxed&&(r.nread+l-a>=r.maxHeaderSize?(l=r.maxHeaderSize-r.nread+a,r.nread=r.maxHeaderSize,r.maxed=!0):r.nread+=l-a,r.buffer+=f.toString("binary",a,l)),i&&r._finish()})}return c(u,_),u.prototype.push=function(t){const r=this.ss.push(t);if(this.finished)return r},u.prototype.reset=function(){this.finished=!1,this.buffer="",this.header={},this.ss.reset()},u.prototype._finish=function(){this.buffer&&this._parseHeader(),this.ss.matches=this.ss.maxMatches;const t=this.header;this.header={},this.buffer="",this.finished=!0,this.nread=this.npairs=0,this.maxed=!1,this.emit("header",t)},u.prototype._parseHeader=function(){if(this.npairs===this.maxHeaderPairs)return;const t=this.buffer.split(e),r=t.length;let i,f;for(var a=0;a<r;++a){if(t[a].length===0)continue;if((t[a][0]==="	"||t[a][0]===" ")&&f){this.header[f][this.header[f].length-1]+=t[a];continue}const l=t[a].indexOf(":");if(l===-1||l===0)return;if(i=s.exec(t[a]),f=i[1].toLowerCase(),this.header[f]=this.header[f]||[],this.header[f].push(i[2]||""),++this.npairs===this.maxHeaderPairs)break}},HeaderParser_1=u,HeaderParser_1}var Dicer_1,hasRequiredDicer;function requireDicer(){if(hasRequiredDicer)return Dicer_1;hasRequiredDicer=1;const _=require$$0__default$1.Writable,c=require$$1__default.inherits,x=requireSbmh(),n=requirePartStream(),h=requireHeaderParser(),e=45,s=Buffer.from("-"),u=Buffer.from(`\r
`),t=function(){};function r(i){if(!(this instanceof r))return new r(i);if(_.call(this,i),!i||!i.headerFirst&&typeof i.boundary!="string")throw new TypeError("Boundary required");typeof i.boundary=="string"?this.setBoundary(i.boundary):this._bparser=void 0,this._headerFirst=i.headerFirst,this._dashes=0,this._parts=0,this._finished=!1,this._realFinish=!1,this._isPreamble=!0,this._justMatched=!1,this._firstWrite=!0,this._inHeader=!0,this._part=void 0,this._cb=void 0,this._ignoreData=!1,this._partOpts={highWaterMark:i.partHwm},this._pause=!1;const f=this;this._hparser=new h(i),this._hparser.on("header",function(a){f._inHeader=!1,f._part.emit("header",a)})}return c(r,_),r.prototype.emit=function(i){if(i==="finish"&&!this._realFinish){if(!this._finished){const f=this;process.nextTick(function(){if(f.emit("error",new Error("Unexpected end of multipart data")),f._part&&!f._ignoreData){const a=f._isPreamble?"Preamble":"Part";f._part.emit("error",new Error(a+" terminated early due to unexpected end of multipart data")),f._part.push(null),process.nextTick(function(){f._realFinish=!0,f.emit("finish"),f._realFinish=!1});return}f._realFinish=!0,f.emit("finish"),f._realFinish=!1})}}else _.prototype.emit.apply(this,arguments)},r.prototype._write=function(i,f,a){if(!this._hparser&&!this._bparser)return a();if(this._headerFirst&&this._isPreamble){this._part||(this._part=new n(this._partOpts),this.listenerCount("preamble")!==0?this.emit("preamble",this._part):this._ignore());const l=this._hparser.push(i);if(!this._inHeader&&l!==void 0&&l<i.length)i=i.slice(l);else return a()}this._firstWrite&&(this._bparser.push(u),this._firstWrite=!1),this._bparser.push(i),this._pause?this._cb=a:a()},r.prototype.reset=function(){this._part=void 0,this._bparser=void 0,this._hparser=void 0},r.prototype.setBoundary=function(i){const f=this;this._bparser=new x(`\r
--`+i),this._bparser.on("info",function(a,l,m,o){f._oninfo(a,l,m,o)})},r.prototype._ignore=function(){this._part&&!this._ignoreData&&(this._ignoreData=!0,this._part.on("error",t),this._part.resume())},r.prototype._oninfo=function(i,f,a,l){let m;const o=this;let d=0,p,g=!0;if(!this._part&&this._justMatched&&f){for(;this._dashes<2&&a+d<l;)if(f[a+d]===e)++d,++this._dashes;else{this._dashes&&(m=s),this._dashes=0;break}if(this._dashes===2&&(a+d<l&&this.listenerCount("trailer")!==0&&this.emit("trailer",f.slice(a+d,l)),this.reset(),this._finished=!0,o._parts===0&&(o._realFinish=!0,o.emit("finish"),o._realFinish=!1)),this._dashes)return}this._justMatched&&(this._justMatched=!1),this._part||(this._part=new n(this._partOpts),this._part._read=function(b){o._unpause()},this._isPreamble&&this.listenerCount("preamble")!==0?this.emit("preamble",this._part):this._isPreamble!==!0&&this.listenerCount("part")!==0?this.emit("part",this._part):this._ignore(),this._isPreamble||(this._inHeader=!0)),f&&a<l&&!this._ignoreData&&(this._isPreamble||!this._inHeader?(m&&(g=this._part.push(m)),g=this._part.push(f.slice(a,l)),g||(this._pause=!0)):!this._isPreamble&&this._inHeader&&(m&&this._hparser.push(m),p=this._hparser.push(f.slice(a,l)),!this._inHeader&&p!==void 0&&p<l&&this._oninfo(!1,f,a+p,l))),i&&(this._hparser.reset(),this._isPreamble?this._isPreamble=!1:a!==l&&(++this._parts,this._part.on("end",function(){--o._parts===0&&(o._finished?(o._realFinish=!0,o.emit("finish"),o._realFinish=!1):o._unpause())})),this._part.push(null),this._part=void 0,this._ignoreData=!1,this._justMatched=!0,this._dashes=0)},r.prototype._unpause=function(){if(this._pause&&(this._pause=!1,this._cb)){const i=this._cb;this._cb=void 0,i()}},Dicer_1=r,Dicer_1}var decodeText_1,hasRequiredDecodeText;function requireDecodeText(){if(hasRequiredDecodeText)return decodeText_1;hasRequiredDecodeText=1;const _=new TextDecoder("utf-8"),c=new Map([["utf-8",_],["utf8",_]]);function x(e){let s;for(;;)switch(e){case"utf-8":case"utf8":return n.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return n.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return n.utf16le;case"base64":return n.base64;default:if(s===void 0){s=!0,e=e.toLowerCase();continue}return n.other.bind(e)}}const n={utf8:(e,s)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,s)),e.utf8Slice(0,e.length)),latin1:(e,s)=>e.length===0?"":typeof e=="string"?e:e.latin1Slice(0,e.length),utf16le:(e,s)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,s)),e.ucs2Slice(0,e.length)),base64:(e,s)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,s)),e.base64Slice(0,e.length)),other:(e,s)=>{if(e.length===0)return"";if(typeof e=="string"&&(e=Buffer.from(e,s)),c.has(this.toString()))try{return c.get(this).decode(e)}catch{}return typeof e=="string"?e:e.toString()}};function h(e,s,u){return e&&x(u)(e,s)}return decodeText_1=h,decodeText_1}var parseParams_1,hasRequiredParseParams;function requireParseParams(){if(hasRequiredParseParams)return parseParams_1;hasRequiredParseParams=1;const _=requireDecodeText(),c=/%[a-fA-F0-9][a-fA-F0-9]/g,x={"%00":"\0","%01":"","%02":"","%03":"","%04":"","%05":"","%06":"","%07":"\x07","%08":"\b","%09":"	","%0a":`
`,"%0A":`
`,"%0b":"\v","%0B":"\v","%0c":"\f","%0C":"\f","%0d":"\r","%0D":"\r","%0e":"","%0E":"","%0f":"","%0F":"","%10":"","%11":"","%12":"","%13":"","%14":"","%15":"","%16":"","%17":"","%18":"","%19":"","%1a":"","%1A":"","%1b":"\x1B","%1B":"\x1B","%1c":"","%1C":"","%1d":"","%1D":"","%1e":"","%1E":"","%1f":"","%1F":"","%20":" ","%21":"!","%22":'"',"%23":"#","%24":"$","%25":"%","%26":"&","%27":"'","%28":"(","%29":")","%2a":"*","%2A":"*","%2b":"+","%2B":"+","%2c":",","%2C":",","%2d":"-","%2D":"-","%2e":".","%2E":".","%2f":"/","%2F":"/","%30":"0","%31":"1","%32":"2","%33":"3","%34":"4","%35":"5","%36":"6","%37":"7","%38":"8","%39":"9","%3a":":","%3A":":","%3b":";","%3B":";","%3c":"<","%3C":"<","%3d":"=","%3D":"=","%3e":">","%3E":">","%3f":"?","%3F":"?","%40":"@","%41":"A","%42":"B","%43":"C","%44":"D","%45":"E","%46":"F","%47":"G","%48":"H","%49":"I","%4a":"J","%4A":"J","%4b":"K","%4B":"K","%4c":"L","%4C":"L","%4d":"M","%4D":"M","%4e":"N","%4E":"N","%4f":"O","%4F":"O","%50":"P","%51":"Q","%52":"R","%53":"S","%54":"T","%55":"U","%56":"V","%57":"W","%58":"X","%59":"Y","%5a":"Z","%5A":"Z","%5b":"[","%5B":"[","%5c":"\\","%5C":"\\","%5d":"]","%5D":"]","%5e":"^","%5E":"^","%5f":"_","%5F":"_","%60":"`","%61":"a","%62":"b","%63":"c","%64":"d","%65":"e","%66":"f","%67":"g","%68":"h","%69":"i","%6a":"j","%6A":"j","%6b":"k","%6B":"k","%6c":"l","%6C":"l","%6d":"m","%6D":"m","%6e":"n","%6E":"n","%6f":"o","%6F":"o","%70":"p","%71":"q","%72":"r","%73":"s","%74":"t","%75":"u","%76":"v","%77":"w","%78":"x","%79":"y","%7a":"z","%7A":"z","%7b":"{","%7B":"{","%7c":"|","%7C":"|","%7d":"}","%7D":"}","%7e":"~","%7E":"~","%7f":"\x7F","%7F":"\x7F","%80":"\x80","%81":"\x81","%82":"\x82","%83":"\x83","%84":"\x84","%85":"\x85","%86":"\x86","%87":"\x87","%88":"\x88","%89":"\x89","%8a":"\x8A","%8A":"\x8A","%8b":"\x8B","%8B":"\x8B","%8c":"\x8C","%8C":"\x8C","%8d":"\x8D","%8D":"\x8D","%8e":"\x8E","%8E":"\x8E","%8f":"\x8F","%8F":"\x8F","%90":"\x90","%91":"\x91","%92":"\x92","%93":"\x93","%94":"\x94","%95":"\x95","%96":"\x96","%97":"\x97","%98":"\x98","%99":"\x99","%9a":"\x9A","%9A":"\x9A","%9b":"\x9B","%9B":"\x9B","%9c":"\x9C","%9C":"\x9C","%9d":"\x9D","%9D":"\x9D","%9e":"\x9E","%9E":"\x9E","%9f":"\x9F","%9F":"\x9F","%a0":"\xA0","%A0":"\xA0","%a1":"\xA1","%A1":"\xA1","%a2":"\xA2","%A2":"\xA2","%a3":"\xA3","%A3":"\xA3","%a4":"\xA4","%A4":"\xA4","%a5":"\xA5","%A5":"\xA5","%a6":"\xA6","%A6":"\xA6","%a7":"\xA7","%A7":"\xA7","%a8":"\xA8","%A8":"\xA8","%a9":"\xA9","%A9":"\xA9","%aa":"\xAA","%Aa":"\xAA","%aA":"\xAA","%AA":"\xAA","%ab":"\xAB","%Ab":"\xAB","%aB":"\xAB","%AB":"\xAB","%ac":"\xAC","%Ac":"\xAC","%aC":"\xAC","%AC":"\xAC","%ad":"\xAD","%Ad":"\xAD","%aD":"\xAD","%AD":"\xAD","%ae":"\xAE","%Ae":"\xAE","%aE":"\xAE","%AE":"\xAE","%af":"\xAF","%Af":"\xAF","%aF":"\xAF","%AF":"\xAF","%b0":"\xB0","%B0":"\xB0","%b1":"\xB1","%B1":"\xB1","%b2":"\xB2","%B2":"\xB2","%b3":"\xB3","%B3":"\xB3","%b4":"\xB4","%B4":"\xB4","%b5":"\xB5","%B5":"\xB5","%b6":"\xB6","%B6":"\xB6","%b7":"\xB7","%B7":"\xB7","%b8":"\xB8","%B8":"\xB8","%b9":"\xB9","%B9":"\xB9","%ba":"\xBA","%Ba":"\xBA","%bA":"\xBA","%BA":"\xBA","%bb":"\xBB","%Bb":"\xBB","%bB":"\xBB","%BB":"\xBB","%bc":"\xBC","%Bc":"\xBC","%bC":"\xBC","%BC":"\xBC","%bd":"\xBD","%Bd":"\xBD","%bD":"\xBD","%BD":"\xBD","%be":"\xBE","%Be":"\xBE","%bE":"\xBE","%BE":"\xBE","%bf":"\xBF","%Bf":"\xBF","%bF":"\xBF","%BF":"\xBF","%c0":"\xC0","%C0":"\xC0","%c1":"\xC1","%C1":"\xC1","%c2":"\xC2","%C2":"\xC2","%c3":"\xC3","%C3":"\xC3","%c4":"\xC4","%C4":"\xC4","%c5":"\xC5","%C5":"\xC5","%c6":"\xC6","%C6":"\xC6","%c7":"\xC7","%C7":"\xC7","%c8":"\xC8","%C8":"\xC8","%c9":"\xC9","%C9":"\xC9","%ca":"\xCA","%Ca":"\xCA","%cA":"\xCA","%CA":"\xCA","%cb":"\xCB","%Cb":"\xCB","%cB":"\xCB","%CB":"\xCB","%cc":"\xCC","%Cc":"\xCC","%cC":"\xCC","%CC":"\xCC","%cd":"\xCD","%Cd":"\xCD","%cD":"\xCD","%CD":"\xCD","%ce":"\xCE","%Ce":"\xCE","%cE":"\xCE","%CE":"\xCE","%cf":"\xCF","%Cf":"\xCF","%cF":"\xCF","%CF":"\xCF","%d0":"\xD0","%D0":"\xD0","%d1":"\xD1","%D1":"\xD1","%d2":"\xD2","%D2":"\xD2","%d3":"\xD3","%D3":"\xD3","%d4":"\xD4","%D4":"\xD4","%d5":"\xD5","%D5":"\xD5","%d6":"\xD6","%D6":"\xD6","%d7":"\xD7","%D7":"\xD7","%d8":"\xD8","%D8":"\xD8","%d9":"\xD9","%D9":"\xD9","%da":"\xDA","%Da":"\xDA","%dA":"\xDA","%DA":"\xDA","%db":"\xDB","%Db":"\xDB","%dB":"\xDB","%DB":"\xDB","%dc":"\xDC","%Dc":"\xDC","%dC":"\xDC","%DC":"\xDC","%dd":"\xDD","%Dd":"\xDD","%dD":"\xDD","%DD":"\xDD","%de":"\xDE","%De":"\xDE","%dE":"\xDE","%DE":"\xDE","%df":"\xDF","%Df":"\xDF","%dF":"\xDF","%DF":"\xDF","%e0":"\xE0","%E0":"\xE0","%e1":"\xE1","%E1":"\xE1","%e2":"\xE2","%E2":"\xE2","%e3":"\xE3","%E3":"\xE3","%e4":"\xE4","%E4":"\xE4","%e5":"\xE5","%E5":"\xE5","%e6":"\xE6","%E6":"\xE6","%e7":"\xE7","%E7":"\xE7","%e8":"\xE8","%E8":"\xE8","%e9":"\xE9","%E9":"\xE9","%ea":"\xEA","%Ea":"\xEA","%eA":"\xEA","%EA":"\xEA","%eb":"\xEB","%Eb":"\xEB","%eB":"\xEB","%EB":"\xEB","%ec":"\xEC","%Ec":"\xEC","%eC":"\xEC","%EC":"\xEC","%ed":"\xED","%Ed":"\xED","%eD":"\xED","%ED":"\xED","%ee":"\xEE","%Ee":"\xEE","%eE":"\xEE","%EE":"\xEE","%ef":"\xEF","%Ef":"\xEF","%eF":"\xEF","%EF":"\xEF","%f0":"\xF0","%F0":"\xF0","%f1":"\xF1","%F1":"\xF1","%f2":"\xF2","%F2":"\xF2","%f3":"\xF3","%F3":"\xF3","%f4":"\xF4","%F4":"\xF4","%f5":"\xF5","%F5":"\xF5","%f6":"\xF6","%F6":"\xF6","%f7":"\xF7","%F7":"\xF7","%f8":"\xF8","%F8":"\xF8","%f9":"\xF9","%F9":"\xF9","%fa":"\xFA","%Fa":"\xFA","%fA":"\xFA","%FA":"\xFA","%fb":"\xFB","%Fb":"\xFB","%fB":"\xFB","%FB":"\xFB","%fc":"\xFC","%Fc":"\xFC","%fC":"\xFC","%FC":"\xFC","%fd":"\xFD","%Fd":"\xFD","%fD":"\xFD","%FD":"\xFD","%fe":"\xFE","%Fe":"\xFE","%fE":"\xFE","%FE":"\xFE","%ff":"\xFF","%Ff":"\xFF","%fF":"\xFF","%FF":"\xFF"};function n(r){return x[r]}const h=0,e=1,s=2,u=3;function t(r){const i=[];let f=h,a="",l=!1,m=!1,o=0,d="";const p=r.length;for(var g=0;g<p;++g){const b=r[g];if(b==="\\"&&l)if(m)m=!1;else{m=!0;continue}else if(b==='"')if(m)m=!1;else{l?(l=!1,f=h):l=!0;continue}else if(m&&l&&(d+="\\"),m=!1,(f===s||f===u)&&b==="'"){f===s?(f=u,a=d.substring(1)):f=e,d="";continue}else if(f===h&&(b==="*"||b==="=")&&i.length){f=b==="*"?s:e,i[o]=[d,void 0],d="";continue}else if(!l&&b===";"){f=h,a?(d.length&&(d=_(d.replace(c,n),"binary",a)),a=""):d.length&&(d=_(d,"binary","utf8")),i[o]===void 0?i[o]=d:i[o][1]=d,d="",++o;continue}else if(!l&&(b===" "||b==="	"))continue;d+=b}return a&&d.length?d=_(d.replace(c,n),"binary",a):d&&(d=_(d,"binary","utf8")),i[o]===void 0?d&&(i[o]=d):i[o][1]=d,i}return parseParams_1=t,parseParams_1}var basename,hasRequiredBasename;function requireBasename(){return hasRequiredBasename||(hasRequiredBasename=1,basename=function(c){if(typeof c!="string")return"";for(var x=c.length-1;x>=0;--x)switch(c.charCodeAt(x)){case 47:case 92:return c=c.slice(x+1),c===".."||c==="."?"":c}return c===".."||c==="."?"":c}),basename}var multipart,hasRequiredMultipart;function requireMultipart(){if(hasRequiredMultipart)return multipart;hasRequiredMultipart=1;const{Readable:_}=require$$0__default$1,{inherits:c}=require$$1__default,x=requireDicer(),n=requireParseParams(),h=requireDecodeText(),e=requireBasename(),s=requireGetLimit(),u=/^boundary$/i,t=/^form-data$/i,r=/^charset$/i,i=/^filename$/i,f=/^name$/i;a.detect=/^multipart\/form-data/i;function a(o,d){let p,g;const b=this;let M;const k=d.limits,G=d.isPartAFile||((w,E,B)=>E==="application/octet-stream"||B!==void 0),P=d.parsedConType||[],Y=d.defCharset||"utf8",X=d.preservePath,I={highWaterMark:d.fileHwm};for(p=0,g=P.length;p<g;++p)if(Array.isArray(P[p])&&u.test(P[p][0])){M=P[p][1];break}function $(){S===0&&W&&!o._done&&(W=!1,b.end())}if(typeof M!="string")throw new Error("Multipart: Boundary not found");const U=s(k,"fieldSize",1*1024*1024),N=s(k,"fileSize",1/0),J=s(k,"files",1/0),Q=s(k,"fields",1/0),Z=s(k,"parts",1/0),ee=s(k,"headerPairs",2e3),te=s(k,"headerSize",80*1024);let K=0,V=0,S=0,T,H,W=!1;this._needDrain=!1,this._pause=!1,this._cb=void 0,this._nparts=0,this._boy=o;const ie={boundary:M,maxHeaderPairs:ee,maxHeaderSize:te,partHwm:I.highWaterMark,highWaterMark:d.highWaterMark};this.parser=new x(ie),this.parser.on("drain",function(){if(b._needDrain=!1,b._cb&&!b._pause){const w=b._cb;b._cb=void 0,w()}}).on("part",function w(E){if(++b._nparts>Z)return b.parser.removeListener("part",w),b.parser.on("part",l),o.hitPartsLimit=!0,o.emit("partsLimit"),l(E);if(H){const B=H;B.emit("end"),B.removeAllListeners("end")}E.on("header",function(B){let A,q,D,R,z,L,v=0;if(B["content-type"]&&(D=n(B["content-type"][0]),D[0])){for(A=D[0].toLowerCase(),p=0,g=D.length;p<g;++p)if(r.test(D[p][0])){R=D[p][1].toLowerCase();break}}if(A===void 0&&(A="text/plain"),R===void 0&&(R=Y),B["content-disposition"]){if(D=n(B["content-disposition"][0]),!t.test(D[0]))return l(E);for(p=0,g=D.length;p<g;++p)f.test(D[p][0])?q=D[p][1]:i.test(D[p][0])&&(L=D[p][1],X||(L=e(L)))}else return l(E);B["content-transfer-encoding"]?z=B["content-transfer-encoding"][0].toLowerCase():z="7bit";let O,j;if(G(q,A,L)){if(K===J)return o.hitFilesLimit||(o.hitFilesLimit=!0,o.emit("filesLimit")),l(E);if(++K,o.listenerCount("file")===0){b.parser._ignore();return}++S;const y=new m(I);T=y,y.on("end",function(){if(--S,b._pause=!1,$(),b._cb&&!b._needDrain){const C=b._cb;b._cb=void 0,C()}}),y._read=function(C){if(b._pause&&(b._pause=!1,b._cb&&!b._needDrain)){const F=b._cb;b._cb=void 0,F()}},o.emit("file",q,y,L,z,A),O=function(C){if((v+=C.length)>N){const F=N-v+C.length;F>0&&y.push(C.slice(0,F)),y.truncated=!0,y.bytesRead=N,E.removeAllListeners("data"),y.emit("limit");return}else y.push(C)||(b._pause=!0);y.bytesRead=v},j=function(){T=void 0,y.push(null)}}else{if(V===Q)return o.hitFieldsLimit||(o.hitFieldsLimit=!0,o.emit("fieldsLimit")),l(E);++V,++S;let y="",C=!1;H=E,O=function(F){if((v+=F.length)>U){const se=U-(v-F.length);y+=F.toString("binary",0,se),C=!0,E.removeAllListeners("data")}else y+=F.toString("binary")},j=function(){H=void 0,y.length&&(y=h(y,"binary",R)),o.emit("field",q,y,!1,C,z,A),--S,$()}}E._readableState.sync=!1,E.on("data",O),E.on("end",j)}).on("error",function(B){T&&T.emit("error",B)})}).on("error",function(w){o.emit("error",w)}).on("finish",function(){W=!0,$()})}a.prototype.write=function(o,d){const p=this.parser.write(o);p&&!this._pause?d():(this._needDrain=!p,this._cb=d)},a.prototype.end=function(){const o=this;o.parser.writable?o.parser.end():o._boy._done||process.nextTick(function(){o._boy._done=!0,o._boy.emit("finish")})};function l(o){o.resume()}function m(o){_.call(this,o),this.bytesRead=0,this.truncated=!1}return c(m,_),m.prototype._read=function(o){},multipart=a,multipart}var Decoder_1,hasRequiredDecoder;function requireDecoder(){if(hasRequiredDecoder)return Decoder_1;hasRequiredDecoder=1;const _=/\+/g,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function x(){this.buffer=void 0}return x.prototype.write=function(n){n=n.replace(_," ");let h="",e=0,s=0;const u=n.length;for(;e<u;++e)this.buffer!==void 0?c[n.charCodeAt(e)]?(this.buffer+=n[e],++s,this.buffer.length===2&&(h+=String.fromCharCode(parseInt(this.buffer,16)),this.buffer=void 0)):(h+="%"+this.buffer,this.buffer=void 0,--e):n[e]==="%"&&(e>s&&(h+=n.substring(s,e),s=e),this.buffer="",++s);return s<u&&this.buffer===void 0&&(h+=n.substring(s)),h},x.prototype.reset=function(){this.buffer=void 0},Decoder_1=x,Decoder_1}var urlencoded,hasRequiredUrlencoded;function requireUrlencoded(){if(hasRequiredUrlencoded)return urlencoded;hasRequiredUrlencoded=1;const _=requireDecoder(),c=requireDecodeText(),x=requireGetLimit(),n=/^charset$/i;h.detect=/^application\/x-www-form-urlencoded/i;function h(e,s){const u=s.limits,t=s.parsedConType;this.boy=e,this.fieldSizeLimit=x(u,"fieldSize",1*1024*1024),this.fieldNameSizeLimit=x(u,"fieldNameSize",100),this.fieldsLimit=x(u,"fields",1/0);let r;for(var i=0,f=t.length;i<f;++i)if(Array.isArray(t[i])&&n.test(t[i][0])){r=t[i][1].toLowerCase();break}r===void 0&&(r=s.defCharset||"utf8"),this.decoder=new _,this.charset=r,this._fields=0,this._state="key",this._checkingBytes=!0,this._bytesKey=0,this._bytesVal=0,this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._hitLimit=!1}return h.prototype.write=function(e,s){if(this._fields===this.fieldsLimit)return this.boy.hitFieldsLimit||(this.boy.hitFieldsLimit=!0,this.boy.emit("fieldsLimit")),s();let u,t,r,i=0;const f=e.length;for(;i<f;)if(this._state==="key"){for(u=t=void 0,r=i;r<f;++r){if(this._checkingBytes||++i,e[r]===61){u=r;break}else if(e[r]===38){t=r;break}if(this._checkingBytes&&this._bytesKey===this.fieldNameSizeLimit){this._hitLimit=!0;break}else this._checkingBytes&&++this._bytesKey}if(u!==void 0)u>i&&(this._key+=this.decoder.write(e.toString("binary",i,u))),this._state="val",this._hitLimit=!1,this._checkingBytes=!0,this._val="",this._bytesVal=0,this._valTrunc=!1,this.decoder.reset(),i=u+1;else if(t!==void 0){++this._fields;let a;const l=this._keyTrunc;if(t>i?a=this._key+=this.decoder.write(e.toString("binary",i,t)):a=this._key,this._hitLimit=!1,this._checkingBytes=!0,this._key="",this._bytesKey=0,this._keyTrunc=!1,this.decoder.reset(),a.length&&this.boy.emit("field",c(a,"binary",this.charset),"",l,!1),i=t+1,this._fields===this.fieldsLimit)return s()}else this._hitLimit?(r>i&&(this._key+=this.decoder.write(e.toString("binary",i,r))),i=r,(this._bytesKey=this._key.length)===this.fieldNameSizeLimit&&(this._checkingBytes=!1,this._keyTrunc=!0)):(i<f&&(this._key+=this.decoder.write(e.toString("binary",i))),i=f)}else{for(t=void 0,r=i;r<f;++r){if(this._checkingBytes||++i,e[r]===38){t=r;break}if(this._checkingBytes&&this._bytesVal===this.fieldSizeLimit){this._hitLimit=!0;break}else this._checkingBytes&&++this._bytesVal}if(t!==void 0){if(++this._fields,t>i&&(this._val+=this.decoder.write(e.toString("binary",i,t))),this.boy.emit("field",c(this._key,"binary",this.charset),c(this._val,"binary",this.charset),this._keyTrunc,this._valTrunc),this._state="key",this._hitLimit=!1,this._checkingBytes=!0,this._key="",this._bytesKey=0,this._keyTrunc=!1,this.decoder.reset(),i=t+1,this._fields===this.fieldsLimit)return s()}else this._hitLimit?(r>i&&(this._val+=this.decoder.write(e.toString("binary",i,r))),i=r,(this._val===""&&this.fieldSizeLimit===0||(this._bytesVal=this._val.length)===this.fieldSizeLimit)&&(this._checkingBytes=!1,this._valTrunc=!0)):(i<f&&(this._val+=this.decoder.write(e.toString("binary",i))),i=f)}s()},h.prototype.end=function(){this.boy._done||(this._state==="key"&&this._key.length>0?this.boy.emit("field",c(this._key,"binary",this.charset),"",this._keyTrunc,!1):this._state==="val"&&this.boy.emit("field",c(this._key,"binary",this.charset),c(this._val,"binary",this.charset),this._keyTrunc,this._valTrunc),this.boy._done=!0,this.boy.emit("finish"))},urlencoded=h,urlencoded}var hasRequiredMain;function requireMain(){if(hasRequiredMain)return main.exports;hasRequiredMain=1;const _=require$$0__default$1.Writable,{inherits:c}=require$$1__default,x=requireDicer(),n=requireMultipart(),h=requireUrlencoded(),e=requireParseParams();function s(u){if(!(this instanceof s))return new s(u);if(typeof u!="object")throw new TypeError("Busboy expected an options-Object.");if(typeof u.headers!="object")throw new TypeError("Busboy expected an options-Object with headers-attribute.");if(typeof u.headers["content-type"]!="string")throw new TypeError("Missing Content-Type-header.");const{headers:t,...r}=u;this.opts={autoDestroy:!1,...r},_.call(this,this.opts),this._done=!1,this._parser=this.getParserByHeaders(t),this._finished=!1}return c(s,_),s.prototype.emit=function(u){if(u==="finish"){if(this._done){if(this._finished)return}else{this._parser?.end();return}this._finished=!0}_.prototype.emit.apply(this,arguments)},s.prototype.getParserByHeaders=function(u){const t=e(u["content-type"]),r={defCharset:this.opts.defCharset,fileHwm:this.opts.fileHwm,headers:u,highWaterMark:this.opts.highWaterMark,isPartAFile:this.opts.isPartAFile,limits:this.opts.limits,parsedConType:t,preservePath:this.opts.preservePath};if(n.detect.test(t[0]))return new n(this,r);if(h.detect.test(t[0]))return new h(this,r);throw new Error("Unsupported Content-Type.")},s.prototype._write=function(u,t,r){this._parser.write(u,r)},main.exports=s,main.exports.default=s,main.exports.Busboy=s,main.exports.Dicer=x,main.exports}exports.requireMain=requireMain;
